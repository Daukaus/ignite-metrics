(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.IgniteMetrics = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var IgniteMetrics=(()=>{var hi=Object.create;var He=Object.defineProperty;var yi=Object.getOwnPropertyDescriptor;var vi=Object.getOwnPropertyNames;var Ei=Object.getPrototypeOf,wi=Object.prototype.hasOwnProperty;var ut=(a,c)=>()=>(c||a((c={exports:{}}).exports,c),c.exports),Ri=(a,c)=>{for(var g in c)He(a,g,{get:c[g],enumerable:!0})},Ht=(a,c,g,t)=>{if(c&&typeof c=="object"||typeof c=="function")for(let h of vi(c))!wi.call(a,h)&&h!==g&&He(a,h,{get:()=>c[h],enumerable:!(t=yi(c,h))||t.enumerable});return a};var Ke=(a,c,g)=>(g=a!=null?hi(Ei(a)):{},Ht(c||!a||!a.__esModule?He(g,"default",{value:a,enumerable:!0}):g,a)),Si=a=>Ht(He({},"__esModule",{value:!0}),a);var ti=ut(I=>{"use strict";var Te=Symbol.for("react.element"),Ii=Symbol.for("react.portal"),Oi=Symbol.for("react.fragment"),Ni=Symbol.for("react.strict_mode"),ki=Symbol.for("react.profiler"),bi=Symbol.for("react.provider"),xi=Symbol.for("react.context"),Ai=Symbol.for("react.forward_ref"),Ti=Symbol.for("react.suspense"),Di=Symbol.for("react.memo"),Li=Symbol.for("react.lazy"),Kt=Symbol.iterator;function Ci(a){return a===null||typeof a!="object"?null:(a=Kt&&a[Kt]||a["@@iterator"],typeof a=="function"?a:null)}var jt={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},qt=Object.assign,Xt={};function ve(a,c,g){this.props=a,this.context=c,this.refs=Xt,this.updater=g||jt}ve.prototype.isReactComponent={};ve.prototype.setState=function(a,c){if(typeof a!="object"&&typeof a!="function"&&a!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,a,c,"setState")};ve.prototype.forceUpdate=function(a){this.updater.enqueueForceUpdate(this,a,"forceUpdate")};function $t(){}$t.prototype=ve.prototype;function _t(a,c,g){this.props=a,this.context=c,this.refs=Xt,this.updater=g||jt}var mt=_t.prototype=new $t;mt.constructor=_t;qt(mt,ve.prototype);mt.isPureReactComponent=!0;var Jt=Array.isArray,Qt=Object.prototype.hasOwnProperty,gt={current:null},Zt={key:!0,ref:!0,__self:!0,__source:!0};function ei(a,c,g){var t,h={},y=null,x=null;if(c!=null)for(t in c.ref!==void 0&&(x=c.ref),c.key!==void 0&&(y=""+c.key),c)Qt.call(c,t)&&!Zt.hasOwnProperty(t)&&(h[t]=c[t]);var L=arguments.length-2;if(L===1)h.children=g;else if(1<L){for(var C=Array(L),J=0;J<L;J++)C[J]=arguments[J+2];h.children=C}if(a&&a.defaultProps)for(t in L=a.defaultProps,L)h[t]===void 0&&(h[t]=L[t]);return{$$typeof:Te,type:a,key:y,ref:x,props:h,_owner:gt.current}}function Bi(a,c){return{$$typeof:Te,type:a.type,key:c,ref:a.ref,props:a.props,_owner:a._owner}}function ht(a){return typeof a=="object"&&a!==null&&a.$$typeof===Te}function Ui(a){var c={"=":"=0",":":"=2"};return"$"+a.replace(/[=:]/g,function(g){return c[g]})}var Yt=/\/+/g;function pt(a,c){return typeof a=="object"&&a!==null&&a.key!=null?Ui(""+a.key):c.toString(36)}function Ye(a,c,g,t,h){var y=typeof a;(y==="undefined"||y==="boolean")&&(a=null);var x=!1;if(a===null)x=!0;else switch(y){case"string":case"number":x=!0;break;case"object":switch(a.$$typeof){case Te:case Ii:x=!0}}if(x)return x=a,h=h(x),a=t===""?"."+pt(x,0):t,Jt(h)?(g="",a!=null&&(g=a.replace(Yt,"$&/")+"/"),Ye(h,c,g,"",function(J){return J})):h!=null&&(ht(h)&&(h=Bi(h,g+(!h.key||x&&x.key===h.key?"":(""+h.key).replace(Yt,"$&/")+"/")+a)),c.push(h)),1;if(x=0,t=t===""?".":t+":",Jt(a))for(var L=0;L<a.length;L++){y=a[L];var C=t+pt(y,L);x+=Ye(y,c,g,C,h)}else if(C=Ci(a),typeof C=="function")for(a=C.call(a),L=0;!(y=a.next()).done;)y=y.value,C=t+pt(y,L++),x+=Ye(y,c,g,C,h);else if(y==="object")throw c=String(a),Error("Objects are not valid as a React child (found: "+(c==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":c)+"). If you meant to render a collection of children, use an array instead.");return x}function Je(a,c,g){if(a==null)return a;var t=[],h=0;return Ye(a,t,"","",function(y){return c.call(g,y,h++)}),t}function Pi(a){if(a._status===-1){var c=a._result;c=c(),c.then(function(g){(a._status===0||a._status===-1)&&(a._status=1,a._result=g)},function(g){(a._status===0||a._status===-1)&&(a._status=2,a._result=g)}),a._status===-1&&(a._status=0,a._result=c)}if(a._status===1)return a._result.default;throw a._result}var H={current:null},je={transition:null},zi={ReactCurrentDispatcher:H,ReactCurrentBatchConfig:je,ReactCurrentOwner:gt};I.Children={map:Je,forEach:function(a,c,g){Je(a,function(){c.apply(this,arguments)},g)},count:function(a){var c=0;return Je(a,function(){c++}),c},toArray:function(a){return Je(a,function(c){return c})||[]},only:function(a){if(!ht(a))throw Error("React.Children.only expected to receive a single React element child.");return a}};I.Component=ve;I.Fragment=Oi;I.Profiler=ki;I.PureComponent=_t;I.StrictMode=Ni;I.Suspense=Ti;I.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=zi;I.cloneElement=function(a,c,g){if(a==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+a+".");var t=qt({},a.props),h=a.key,y=a.ref,x=a._owner;if(c!=null){if(c.ref!==void 0&&(y=c.ref,x=gt.current),c.key!==void 0&&(h=""+c.key),a.type&&a.type.defaultProps)var L=a.type.defaultProps;for(C in c)Qt.call(c,C)&&!Zt.hasOwnProperty(C)&&(t[C]=c[C]===void 0&&L!==void 0?L[C]:c[C])}var C=arguments.length-2;if(C===1)t.children=g;else if(1<C){L=Array(C);for(var J=0;J<C;J++)L[J]=arguments[J+2];t.children=L}return{$$typeof:Te,type:a.type,key:h,ref:y,props:t,_owner:x}};I.createContext=function(a){return a={$$typeof:xi,_currentValue:a,_currentValue2:a,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},a.Provider={$$typeof:bi,_context:a},a.Consumer=a};I.createElement=ei;I.createFactory=function(a){var c=ei.bind(null,a);return c.type=a,c};I.createRef=function(){return{current:null}};I.forwardRef=function(a){return{$$typeof:Ai,render:a}};I.isValidElement=ht;I.lazy=function(a){return{$$typeof:Li,_payload:{_status:-1,_result:a},_init:Pi}};I.memo=function(a,c){return{$$typeof:Di,type:a,compare:c===void 0?null:c}};I.startTransition=function(a){var c=je.transition;je.transition={};try{a()}finally{je.transition=c}};I.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};I.useCallback=function(a,c){return H.current.useCallback(a,c)};I.useContext=function(a){return H.current.useContext(a)};I.useDebugValue=function(){};I.useDeferredValue=function(a){return H.current.useDeferredValue(a)};I.useEffect=function(a,c){return H.current.useEffect(a,c)};I.useId=function(){return H.current.useId()};I.useImperativeHandle=function(a,c,g){return H.current.useImperativeHandle(a,c,g)};I.useInsertionEffect=function(a,c){return H.current.useInsertionEffect(a,c)};I.useLayoutEffect=function(a,c){return H.current.useLayoutEffect(a,c)};I.useMemo=function(a,c){return H.current.useMemo(a,c)};I.useReducer=function(a,c,g){return H.current.useReducer(a,c,g)};I.useRef=function(a){return H.current.useRef(a)};I.useState=function(a){return H.current.useState(a)};I.useSyncExternalStore=function(a,c,g){return H.current.useSyncExternalStore(a,c,g)};I.useTransition=function(){return H.current.useTransition()};I.version="18.2.0"});var qe=ut((qi,ii)=>{"use strict";ii.exports=ti()});var ri=ut((ni,$e)=>{(function(a,c){typeof define=="function"&&define.amd?define([],function(){return c(a.Countly)}):typeof $e=="object"&&$e.exports?$e.exports=c(a.Countly):a.Countly=c(a.Countly)})(typeof window<"u"?window:ni,function(a){if(typeof window>"u")return;a=a||{};var c={SESSIONS:"sessions",EVENTS:"events",VIEWS:"views",SCROLLS:"scrolls",CLICKS:"clicks",FORMS:"forms",CRASHES:"crashes",ATTRIBUTION:"attribution",USERS:"users",STAR_RATING:"star-rating",LOCATION:"location",APM:"apm",FEEDBACK:"feedback",REMOTE_CONFIG:"remote-config"};a.features=[c.SESSIONS,c.EVENTS,c.VIEWS,c.SCROLLS,c.CLICKS,c.FORMS,c.CRASHES,c.ATTRIBUTION,c.USERS,c.STAR_RATING,c.LOCATION,c.APM,c.FEEDBACK,c.REMOTE_CONFIG];var g={NPS:"[CLY]_nps",SURVEY:"[CLY]_survey",STAR_RATING:"[CLY]_star_rating",VIEW:"[CLY]_view",ORIENTATION:"[CLY]_orientation",PUSH_ACTION:"[CLY]_push_action",ACTION:"[CLY]_action"},t={ERROR:"[ERROR] ",WARNING:"[WARNING] ",INFO:"[INFO] ",DEBUG:"[DEBUG] ",VERBOSE:"[VERBOSE] "},h={DEVELOPER_SUPPLIED:0,SDK_GENERATED:1,TEMPORARY_ID:2,URL_PROVIDED:3},y={BEAT_INTERVAL:500,QUEUE_SIZE:1e3,FAIL_TIMEOUT_AMOUNT:60,INACTIVITY_TIME:20,SESSION_UPDATE:60,MAX_EVENT_BATCH:100,SESSION_COOKIE_TIMEOUT:30,MAX_KEY_LENGTH:128,MAX_VALUE_SIZE:256,MAX_SEGMENTATION_VALUES:30,MAX_BREADCRUMB_COUNT:100,MAX_STACKTRACE_LINES_PER_THREAD:30,MAX_STACKTRACE_LINE_LENGTH:200};a.q=a.q||[],a.onload=a.onload||[];var x="22.06.4",L="javascript_native_web",C=/^(((([^:\/#\?]+:)?(?:(\/\/)((?:(([^:@\/#\?]+)(?:\:([^:@\/#\?]+))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?:\:([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/,J=function(o){var r=this,E=!a.i,w=!1,P="/i",K="/o/sdk",Y=v("interval",o,y.BEAT_INTERVAL),Z=v("queue_size",o,y.QUEUE_SIZE),T=[],z=[],M={},oe=[],se={},ee=v("ignore_referrers",o,[]),it=null,Re=!0,fe,nt=0,te=null,Se=0,Ie=0,rt=0,Ue=v("fail_timeout",o,y.FAIL_TIMEOUT_AMOUNT),Oe=v("inactivity_time",o,y.INACTIVITY_TIME),Ne=0,Pe=v("session_update",o,y.SESSION_UPDATE),ke=v("max_events",o,y.MAX_EVENT_BATCH),he=v("max_logs",o,null),ue=v("use_session_cookie",o,!0),be=v("session_cookie_timeout",o,y.SESSION_COOKIE_TIMEOUT),ze=!0,Ve=!1,G=v("offline_mode",o,!1),ce={},pe=!0,Dt=U(),_e=!0,ye=null,V=h.SDK_GENERATED,xe=!1,Ae=0;try{localStorage.setItem("cly_testLocal",!0),localStorage.removeItem("cly_testLocal")}catch(e){i(t.ERROR,"Local storage test failed, Halting local storage support: "+e),_e=!1}for(var B={},at=0;at<a.features.length;at++)B[a.features[at]]={};this.initialize=function(){if(this.serialize=v("serialize",o,a.serialize),this.deserialize=v("deserialize",o,a.deserialize),this.getViewName=v("getViewName",o,a.getViewName),this.getViewUrl=v("getViewUrl",o,a.getViewUrl),this.getSearchQuery=v("getSearchQuery",o,a.getSearchQuery),this.DeviceIdType=a.DeviceIdType,this.namespace=v("namespace",o,""),this.clearStoredId=v("clear_stored_id",o,!1),this.app_key=v("app_key",o,null),this.onload=v("onload",o,[]),this.utm=v("utm",o,{source:!0,medium:!0,campaign:!0,term:!0,content:!0}),this.ignore_prefetch=v("ignore_prefetch",o,!0),this.rcAutoOptinAb=v("rc_automatic_optin_for_ab",o,!0),this.useExplicitRcApi=v("use_explicit_rc_api",o,!1),this.debug=v("debug",o,!1),this.test_mode=v("test_mode",o,!1),this.metrics=v("metrics",o,{}),this.headers=v("headers",o,{}),this.url=ge(v("url",o,"")),this.app_version=v("app_version",o,"0.0"),this.country_code=v("country_code",o,null),this.city=v("city",o,null),this.ip_address=v("ip_address",o,null),this.ignore_bots=v("ignore_bots",o,!0),this.force_post=v("force_post",o,!1),this.remote_config=v("remote_config",o,!1),this.ignore_visitor=v("ignore_visitor",o,!1),this.require_consent=v("require_consent",o,!1),this.track_domains=v("track_domains",o,!0),this.storage=v("storage",o,"default"),this.enableOrientationTracking=v("enable_orientation_tracking",o,!0),this.maxKeyLength=v("max_key_length",o,y.MAX_KEY_LENGTH),this.maxValueSize=v("max_value_size",o,y.MAX_VALUE_SIZE),this.maxSegmentationValues=v("max_segmentation_values",o,y.MAX_SEGMENTATION_VALUES),this.maxBreadcrumbCount=v("max_breadcrumb_count",o,null),this.maxStackTraceLinesPerThread=v("max_stack_trace_lines_per_thread",o,y.MAX_STACKTRACE_LINES_PER_THREAD),this.maxStackTraceLineLength=v("max_stack_trace_line_length",o,y.MAX_STACKTRACE_LINE_LENGTH),this.heatmapWhitelist=v("heatmap_whitelist",o,[]),he&&!this.maxBreadcrumbCount?(this.maxBreadcrumbCount=he,i(t.WARNING,"initialize, 'maxCrashLogs' is deprecated. Use 'maxBreadcrumbCount' instead!")):!he&&!this.maxBreadcrumbCount&&(this.maxBreadcrumbCount=100),this.storage==="cookie"&&(_e=!1),!this.rcAutoOptinAb&&!this.useExplicitRcApi&&(i(t.WARNING,"initialize, Auto opting is disabled, switching to explicit RC API"),this.useExplicitRcApi=!0),Array.isArray(ee)||(ee=[]),this.url===""&&(i(t.ERROR,"initialize, Please provide server URL"),this.ignore_visitor=!0),k("cly_ignore")&&(this.ignore_visitor=!0),mi(),this.clearStoredId&&(i(t.INFO,"initialize, Clearing the device ID storage"),localStorage.removeItem(this.app_key+"/cly_id"),localStorage.removeItem(this.app_key+"/cly_id_type")),T=k("cly_queue")||[],z=k("cly_event")||[],M=k("cly_remote_configs")||{},Bt(),window.name&&window.name.indexOf("cly:")===0)try{this.passed_data=JSON.parse(window.name.replace("cly:",""))}catch(A){i(t.ERROR,"initialize, Could not parse name: "+window.name+", error: "+A)}else if(location.hash&&location.hash.indexOf("#cly:")===0)try{this.passed_data=JSON.parse(location.hash.replace("#cly:",""))}catch(A){i(t.ERROR,"initialize, Could not parse hash: "+location.hash+", error: "+A)}if((this.passed_data&&this.passed_data.app_key&&this.passed_data.app_key===this.app_key||this.passed_data&&!this.passed_data.app_key&&E)&&this.passed_data.token&&this.passed_data.purpose){this.passed_data.token!==k("cly_old_token")&&(Mt(this.passed_data.token),S("cly_old_token",this.passed_data.token));var e=[];Array.isArray(this.heatmapWhitelist)?(this.heatmapWhitelist.push(this.url),e=this.heatmapWhitelist.map(function(A){return ge(A)})):e=[this.url],e.includes(this.passed_data.url)&&this.passed_data.purpose==="heatmap"&&(this.ignore_visitor=!0,At(),xt(this.passed_data.url+"/views/heatmap.js",Tt))}if(this.ignore_visitor){i(t.WARNING,"initialize, ignore_visitor:["+this.ignore_visitor+"], this user will not be tracked");return}i(t.DEBUG,"initialize, app_key:["+this.app_key+"], url:["+this.url+"]"),i(t.DEBUG,"initialize, device_id:["+v("device_id",o,void 0)+"]"),i(t.DEBUG,"initialize, require_consent is enabled:["+this.require_consent+"]");try{i(t.DEBUG,"initialize, metric override:["+JSON.stringify(this.metrics)+"]"),i(t.DEBUG,"initialize, header override:["+JSON.stringify(this.headers)+"]"),i(t.DEBUG,"initialize, number of onload callbacks provided:["+this.onload.length+"]"),i(t.DEBUG,"initialize, utm tags:["+JSON.stringify(this.utm)+"]"),ee&&i(t.DEBUG,"initialize, referrers to ignore :["+JSON.stringify(ee)+"]")}catch{i(t.ERROR,"initialize, Could not stringify some config object values")}i(t.DEBUG,"initialize, app_version:["+this.app_version+"]"),i(t.DEBUG,"initialize, provided location info; country_code:["+this.country_code+"], city:["+this.city+"], ip_address:["+this.ip_address+"]"),this.namespace!==""&&i(t.DEBUG,"initialize, namespace given:["+this.namespace+"]"),this.clearStoredId&&i(t.DEBUG,"initialize, clearStoredId flag set to:["+this.clearStoredId+"]"),this.ignore_prefetch&&i(t.DEBUG,"initialize, ignoring pre-fetching and pre-rendering from counting as real website visits :["+this.ignore_prefetch+"]"),this.test_mode&&i(t.WARNING,"initialize, test_mode:["+this.test_mode+"], queues won't be processed"),this.heatmapWhitelist&&i(t.DEBUG,"initialize, heatmap whitelist:["+JSON.stringify(this.heatmapWhitelist)+"], these domains will be whitelisted"),this.storage!=="default"&&i(t.DEBUG,"initialize, storage is set to:["+this.storage+"]"),this.ignore_bots&&i(t.DEBUG,"initialize, ignore traffic from bots :["+this.ignore_bots+"]"),this.force_post&&i(t.DEBUG,"initialize, forced post method for all requests:["+this.force_post+"]"),this.remote_config&&i(t.DEBUG,"initialize, remote_config callback provided:["+!!this.remote_config+"]"),typeof this.rcAutoOptinAb=="boolean"&&i(t.DEBUG,"initialize, automatic RC optin is enabled:["+this.rcAutoOptinAb+"]"),this.useExplicitRcApi||i(t.WARNING,"initialize, will use legacy RC API. Consider enabling new API during init with use_explicit_rc_api flag"),this.track_domains&&i(t.DEBUG,"initialize, tracking domain info:["+this.track_domains+"]"),this.enableOrientationTracking&&i(t.DEBUG,"initialize, enableOrientationTracking:["+this.enableOrientationTracking+"]"),ue||i(t.WARNING,"initialize, use_session_cookie is enabled:["+ue+"]"),G&&i(t.DEBUG,"initialize, offline_mode:["+G+"], user info won't be send to the servers"),G&&i(t.DEBUG,"initialize, stored remote configs:["+JSON.stringify(M)+"]"),i(t.DEBUG,"initialize, 'getViewName' callback override provided:["+!!this.getViewName+"]"),i(t.DEBUG,"initialize, 'getSearchQuery' callback override provided:["+!!this.getSearchQuery+"]"),this.maxKeyLength!==y.MAX_KEY_LENGTH&&i(t.DEBUG,"initialize, maxKeyLength set to:["+this.maxKeyLength+"] characters"),this.maxValueSize!==y.MAX_VALUE_SIZE&&i(t.DEBUG,"initialize, maxValueSize set to:["+this.maxValueSize+"] characters"),this.maxSegmentationValues!==y.MAX_SEGMENTATION_VALUES&&i(t.DEBUG,"initialize, maxSegmentationValues set to:["+this.maxSegmentationValues+"] key/value pairs"),this.maxBreadcrumbCount!==y.MAX_BREADCRUMB_COUNT&&i(t.DEBUG,"initialize, maxBreadcrumbCount for custom logs set to:["+this.maxBreadcrumbCount+"] entries"),this.maxStackTraceLinesPerThread!==y.MAX_STACKTRACE_LINES_PER_THREAD&&i(t.DEBUG,"initialize, maxStackTraceLinesPerThread set to:["+this.maxStackTraceLinesPerThread+"] lines"),this.maxStackTraceLineLength!==y.MAX_STACKTRACE_LINE_LENGTH&&i(t.DEBUG,"initialize, maxStackTraceLineLength set to:["+this.maxStackTraceLineLength+"] characters"),Y!==y.BEAT_INTERVAL&&i(t.DEBUG,"initialize, interval for heartbeats set to:["+Y+"] milliseconds"),Z!==y.QUEUE_SIZE&&i(t.DEBUG,"initialize, queue_size set to:["+Z+"] items max"),Ue!==y.FAIL_TIMEOUT_AMOUNT&&i(t.DEBUG,"initialize, fail_timeout set to:["+Ue+"] seconds of wait time after a failed connection to server"),Oe!==y.INACTIVITY_TIME&&i(t.DEBUG,"initialize, inactivity_time set to:["+Oe+"] minutes to consider a user as inactive after no observable action"),Pe!==y.SESSION_UPDATE&&i(t.DEBUG,"initialize, session_update set to:["+Pe+"] seconds to check if extending a session is needed while the user is active"),ke!==y.MAX_EVENT_BATCH&&i(t.DEBUG,"initialize, max_events set to:["+ke+"] events to send in one batch"),he&&i(t.WARNING,"initialize, max_logs set to:["+he+"] breadcrumbs to store for crash logs max, deprecated "),be!==y.SESSION_COOKIE_TIMEOUT&&i(t.DEBUG,"initialize, session_cookie_timeout set to:["+be+"] minutes to expire a cookies session"),i(t.INFO,"initialize, Countly initialized");var n=null,s=r.getSearchQuery(),f=!1,p={};if(s)for(var l=s.substring(1).split("&"),u=0;u<l.length;u++){var d=l[u].split("=");d[0]==="cly_id"?S("cly_cmp_id",d[1]):d[0]==="cly_uid"?S("cly_cmp_uid",d[1]):d[0]==="cly_device_id"?n=d[1]:(d[0]+"").indexOf("utm_")===0&&this.utm[d[0].replace("utm_","")]&&(p[d[0].replace("utm_","")]=d[1],f=!0)}var _=k("cly_id")==="[CLY]_temp_id",m=v("device_id",o,void 0);if(k("cly_id")&&!_?(this.device_id=k("cly_id"),i(t.INFO,"initialize, Set the stored device ID"),V=k("cly_id_type"),V||(i(t.INFO,"initialize, No device ID type info from the previous session, falling back to DEVELOPER_SUPPLIED"),V=h.DEVELOPER_SUPPLIED)):n!==null?(i(t.INFO,"initialize, Device ID set by URL"),this.device_id=n,V=h.URL_PROVIDED):m?(i(t.INFO,"initialize, Device ID set by developer"),this.device_id=m,o&&Object.keys(o).length?o.device_id!==void 0&&(V=h.DEVELOPER_SUPPLIED):a.device_id!==void 0&&(V=h.DEVELOPER_SUPPLIED)):G||_?(this.device_id="[CLY]_temp_id",V=h.TEMPORARY_ID,G&&_?i(t.INFO,"initialize, Temp ID set, continuing offline mode from previous app session"):G&&!_?i(t.INFO,"initialize, Temp ID set, entering offline mode"):(G=!0,i(t.INFO,"initialize, Temp ID set, enabling offline mode"))):(i(t.INFO,"initialize, Generating the device ID"),this.device_id=v("device_id",o,lt()),o&&Object.keys(o).length?o.device_id!==void 0&&(V=h.DEVELOPER_SUPPLIED):a.device_id!==void 0&&(V=h.DEVELOPER_SUPPLIED)),S("cly_id",this.device_id),S("cly_id_type",V),f){for(var R in this.utm)p[R]?this.userData.set("utm_"+R,p[R]):this.userData.unset("utm_"+R);this.userData.save()}Ut(),setTimeout(function(){Me(),r.remote_config&&r.fetch_remote_config(r.remote_config)},1),document.documentElement.setAttribute("data-countly-useragent",we())},this.halt=function(){i(t.WARNING,"halt, Resetting Countly"),a.i=void 0,E=!a.i,w=!1,P="/i",K="/o/sdk",Y=500,Z=1e3,T=[],z=[],M={},oe=[],se={},ee=[],it=null,Re=!0,nt=0,te=null,Se=0,Ie=0,rt=0,Ue=60,Oe=20,Ne=0,Pe=60,ke=100,he=null,ue=!0,be=30,ze=!0,Ve=!1,G=!1,ce={},pe=!0,Dt=U(),_e=!0,ye=null,V=h.SDK_GENERATED,xe=!1,Ae=0;try{localStorage.setItem("cly_testLocal",!0),localStorage.removeItem("cly_testLocal")}catch{i(t.ERROR,"halt, Local storage test failed, will fallback to cookies"),_e=!1}a.features=[c.SESSIONS,c.EVENTS,c.VIEWS,c.SCROLLS,c.CLICKS,c.FORMS,c.CRASHES,c.ATTRIBUTION,c.USERS,c.STAR_RATING,c.LOCATION,c.APM,c.FEEDBACK,c.REMOTE_CONFIG],B={};for(var e=0;e<a.features.length;e++)B[a.features[e]]={};r.app_key=void 0,r.device_id=void 0,r.onload=void 0,r.utm=void 0,r.ignore_prefetch=void 0,r.debug=void 0,r.test_mode=void 0,r.metrics=void 0,r.headers=void 0,r.url=void 0,r.app_version=void 0,r.country_code=void 0,r.city=void 0,r.ip_address=void 0,r.ignore_bots=void 0,r.force_post=void 0,r.rcAutoOptinAb=void 0,r.useExplicitRcApi=void 0,r.remote_config=void 0,r.ignore_visitor=void 0,r.require_consent=void 0,r.track_domains=void 0,r.storage=void 0,r.enableOrientationTracking=void 0,r.maxKeyLength=void 0,r.maxValueSize=void 0,r.maxSegmentationValues=void 0,r.maxBreadcrumbCount=void 0,r.maxStackTraceLinesPerThread=void 0,r.maxStackTraceLineLength=void 0},this.group_features=function(e){if(i(t.INFO,"group_features, Grouping features"),e)for(var n in e)B[n]?i(t.WARNING,"group_features, Feature name ["+n+"] is already reserved"):typeof e[n]=="string"?B[n]={features:[e[n]]}:e[n]&&Array.isArray(e[n])&&e[n].length?B[n]={features:e[n]}:i(t.ERROR,"group_features, Incorrect feature list for ["+n+"] value: ["+e[n]+"]");else i(t.ERROR,"group_features, Incorrect features:["+e+"]")},this.check_consent=function(e){return i(t.INFO,"check_consent, Checking if consent is given for specific feature:["+e+"]"),this.require_consent?B[e]?!!(B[e]&&B[e].optin):(i(t.ERROR,"check_consent, No feature available for ["+e+"]"),!1):(i(t.INFO,"check_consent, require_consent is off, no consent is necessary"),!0)},this.get_device_id_type=function(){i(t.INFO,"check_device_id_type, Retrieving the current device id type.["+V+"]");var e;switch(V){case h.SDK_GENERATED:e=r.DeviceIdType.SDK_GENERATED;break;case h.URL_PROVIDED:case h.DEVELOPER_SUPPLIED:e=r.DeviceIdType.DEVELOPER_SUPPLIED;break;case h.TEMPORARY_ID:e=r.DeviceIdType.TEMPORARY_ID;break;default:e=-1;break}return e},this.get_device_id=function(){return i(t.INFO,"get_device_id, Retrieving the device id: ["+this.device_id+"]"),this.device_id},this.check_any_consent=function(){if(i(t.INFO,"check_any_consent, Checking if any consent is given"),!this.require_consent)return i(t.INFO,"check_any_consent, require_consent is off, no consent is necessary"),!0;for(var e in B)if(B[e]&&B[e].optin)return!0;return i(t.INFO,"check_any_consent, No consents given"),!1},this.add_consent=function(e){if(i(t.INFO,"add_consent, Adding consent for ["+e+"]"),Array.isArray(e))for(var n=0;n<e.length;n++)this.add_consent(e[n]);else B[e]?B[e].features?(B[e].optin=!0,this.add_consent(B[e].features)):B[e].optin!==!0&&(B[e].optin=!0,Lt(),setTimeout(function(){e===c.SESSIONS&&ce.begin_session?(r.begin_session.apply(r,ce.begin_session),ce.begin_session=null):e===c.VIEWS&&ce.track_pageview&&(te=null,r.track_pageview.apply(r,ce.track_pageview),ce.track_pageview=null)},1)):i(t.ERROR,"add_consent, No feature available for ["+e+"]")},this.remove_consent=function(e){i(t.INFO,"remove_consent, Removing consent for ["+e+"]"),this.remove_consent_internal(e,!0)},this.remove_consent_internal=function(e,n){if(n=n||!1,Array.isArray(e))for(var s=0;s<e.length;s++)this.remove_consent_internal(e[s],n);else B[e]?B[e].features?this.remove_consent_internal(B[e].features,n):(B[e].optin=!1,n&&B[e].optin!==!1&&Lt()):i(t.ERROR,"remove_consent, No feature available for ["+e+"]")};var Ge,Lt=function(){Ge&&(clearTimeout(Ge),Ge=null),Ge=setTimeout(function(){for(var e={},n=0;n<a.features.length;n++)B[a.features[n]].optin===!0?e[a.features[n]]=!0:e[a.features[n]]=!1;W({consent:JSON.stringify(e)}),i(t.DEBUG,"Consent update request has been sent to the queue.")},1e3)};this.enable_offline_mode=function(){i(t.INFO,"enable_offline_mode, Enabling offline mode"),this.remove_consent_internal(a.features,!1),G=!0,this.device_id="[CLY]_temp_id",V=h.TEMPORARY_ID},this.disable_offline_mode=function(e){i(t.INFO,"disable_offline_mode, Disabling offline mode"),G=!1,e&&this.device_id!==e?(this.device_id=e,V=h.DEVELOPER_SUPPLIED,S("cly_id",this.device_id),S("cly_id_type",h.DEVELOPER_SUPPLIED),i(t.INFO,"disable_offline_mode, Changing id to: "+this.device_id)):(this.device_id=lt(),this.device_id!==k("cly_id")&&(S("cly_id",this.device_id),S("cly_id_type",h.SDK_GENERATED)));var n=!1;if(T.length>0)for(var s=0;s<T.length;s++)T[s].device_id==="[CLY]_temp_id"&&(T[s].device_id=this.device_id,n=!0);n&&S("cly_queue",T,!0)},this.begin_session=function(e,n){if(i(t.INFO,"begin_session, Starting the session"),e&&i(t.INFO,"begin_session, Heartbeats are disabled"),n&&i(t.INFO,"begin_session, Session starts irrespective of session cookie"),this.check_consent(c.SESSIONS)){if(!w){this.enableOrientationTracking&&(this.report_orientation(),N(window,"resize",function(){r.report_orientation()})),fe=U(),w=!0,Re=!e;var s=k("cly_session");if(n||!ue||!s||parseInt(s)<=U()){i(t.INFO,"begin_session, Session started"),ye===null&&(ye=!0);var f={};f.begin_session=1,f.metrics=JSON.stringify(Fe()),W(f)}S("cly_session",U()+be*60)}}else ce.begin_session=arguments},this.session_duration=function(e){i(t.INFO,"session_duration, Reporting session duration"),this.check_consent(c.SESSIONS)&&w&&(i(t.INFO,"session_duration, Session extended: ",e),W({session_duration:e}),Pt())},this.end_session=function(e,n){i(t.INFO,"end_session, Ending the current session"),this.check_consent(c.SESSIONS)&&w&&(e=e||U()-fe,ct(),!ue||n?(i(t.INFO,"end_session, Session ended"),W({end_session:1,session_duration:e})):this.session_duration(e),w=!1)},this.change_id=function(e,n){if(i(t.INFO,"change_id, Changing the ID"),n&&i(t.INFO,"change_id, Will merge the IDs"),!e||typeof e!="string"||e.length===0){i(t.ERROR,"change_id, The provided ID: ["+e+"] is not a valid ID");return}if(G){i(t.WARNING,"change_id, Offline mode was on, initiating disabling sequence instead."),this.disable_offline_mode(e);return}if(this.device_id!==e){n||(ot(),this.end_session(null,!0),se={},this.remove_consent_internal(a.features,!1));var s=this.device_id;this.device_id=e,V=h.DEVELOPER_SUPPLIED,S("cly_id",this.device_id),S("cly_id_type",h.DEVELOPER_SUPPLIED),i(t.INFO,"change_id, Changing ID from:["+s+"] to ["+e+"]"),n?W({old_device_id:s}):this.begin_session(!Re,!0),this.remote_config&&(M={},S("cly_remote_configs",M),this.fetch_remote_config(this.remote_config))}},this.add_event=function(e){i(t.INFO,"add_event, Adding event: ",e);var n=!1;switch(e.key){case g.NPS:n=this.check_consent("feedback");break;case g.SURVEY:n=this.check_consent("feedback");break;case g.STAR_RATING:n=this.check_consent("star-rating");break;case g.VIEW:n=this.check_consent("views");break;case g.ORIENTATION:n=this.check_consent("users");break;case g.PUSH_ACTION:n=this.check_consent("push");break;case g.ACTION:n=this.check_consent("clicks")||this.check_consent("scroll");break;default:n=this.check_consent("events")}n&&X(e)};function X(e){if(r.ignore_visitor){i(t.ERROR,"Adding event failed. Possible bot or user opt out");return}if(!e.key){i(t.ERROR,"Adding event failed. Event must have a key property");return}e.count||(e.count=1),e.key=O(e.key,r.maxKeyLength,"add_cly_event",i),e.segmentation=ae(e.segmentation,r.maxKeyLength,r.maxValueSize,r.maxSegmentationValues,"add_cly_event",i);var n=["key","count","sum","dur","segmentation"],s=Ee(e,n);s.timestamp=Qe();var f=new Date;s.hour=f.getHours(),s.dow=f.getDay(),z.push(s),S("cly_event",z),i(t.INFO,"Successfully adding event: ",e)}this.start_event=function(e){if(i(t.INFO,"start_event, Starting timed event with key: ["+e+"]"),e=O(e,r.maxKeyLength,"start_event",i),se[e]){i(t.WARNING,"start_event, Timed event with key ["+e+"] already started");return}se[e]=U()},this.end_event=function(e){if(i(t.INFO,"end_event, Ending timed event"),typeof e=="string"&&(e={key:e}),!e.key){i(t.ERROR,"end_event, Timed event must have a key property");return}if(!se[e.key]){i(t.ERROR,"end_event, Timed event with key ["+e.key+"] was not started");return}e.dur=U()-se[e.key],this.add_event(e),delete se[e.key]},this.report_orientation=function(e){i(t.INFO,"report_orientation, Reporting orientation"),this.check_consent(c.USERS)&&X({key:g.ORIENTATION,segmentation:{mode:e||si()}})},this.report_conversion=function(e,n){i(t.WARNING,"report_conversion, Deprecated function call! Use 'recordDirectAttribution' in place of this call. Call will be redirected now!"),this.recordDirectAttribution(e,n)},this.recordDirectAttribution=function(e,n){i(t.INFO,"recordDirectAttribution, Recording the attribution for campaign ID: ["+e+"] and the user ID: ["+n+"]"),this.check_consent(c.ATTRIBUTION)&&(e=e||k("cly_cmp_id")||"cly_organic",n=n||k("cly_cmp_uid"),W(n?{campaign_id:e,campaign_user:n}:{campaign_id:e}))},this.user_details=function(e){if(i(t.INFO,"user_details, Trying to add user details: ",e),this.check_consent(c.USERS)){e.name=O(e.name,r.maxValueSize,"user_details",i),e.username=O(e.username,r.maxValueSize,"user_details",i),e.email=O(e.email,r.maxValueSize,"user_details",i),e.organization=O(e.organization,r.maxValueSize,"user_details",i),e.phone=O(e.phone,r.maxValueSize,"user_details",i),e.picture=O(e.picture,4096,"user_details",i),e.gender=O(e.gender,r.maxValueSize,"user_details",i),e.byear=O(e.byear,r.maxValueSize,"user_details",i),e.custom=ae(e.custom,r.maxKeyLength,r.maxValueSize,r.maxSegmentationValues,"user_details",i);var n=["name","username","email","organization","phone","picture","gender","byear","custom"];W({user_details:JSON.stringify(Ee(e,n))})}};var ie={},de=function(e,n,s){r.check_consent(c.USERS)&&(ie[e]||(ie[e]={}),s==="$push"||s==="$pull"||s==="$addToSet"?(ie[e][s]||(ie[e][s]=[]),ie[e][s].push(n)):ie[e][s]=n)};this.userData={set:function(e,n){i(t.INFO,"set, Setting user's custom property value: ["+n+"] under the key: ["+e+"]"),e=O(e,r.maxKeyLength,"userData set",i),n=O(n,r.maxValueSize,"userData set",i),ie[e]=n},unset:function(e){i(t.INFO,"unset, Resetting user's custom property with key: ["+e+"] "),ie[e]=""},set_once:function(e,n){i(t.INFO,"set_once, Setting user's unique custom property value: ["+n+"] under the key: ["+e+"] "),e=O(e,r.maxKeyLength,"userData set_once",i),n=O(n,r.maxValueSize,"userData set_once",i),de(e,n,"$setOnce")},increment:function(e){i(t.INFO,"increment, Increasing user's custom property value under the key: ["+e+"] by one"),e=O(e,r.maxKeyLength,"userData increment",i),de(e,1,"$inc")},increment_by:function(e,n){i(t.INFO,"increment_by, Increasing user's custom property value under the key: ["+e+"] by: ["+n+"]"),e=O(e,r.maxKeyLength,"userData increment_by",i),n=O(n,r.maxValueSize,"userData increment_by",i),de(e,n,"$inc")},multiply:function(e,n){i(t.INFO,"multiply, Multiplying user's custom property value under the key: ["+e+"] by: ["+n+"]"),e=O(e,r.maxKeyLength,"userData multiply",i),n=O(n,r.maxValueSize,"userData multiply",i),de(e,n,"$mul")},max:function(e,n){i(t.INFO,"max, Saving user's maximum custom property value compared to the value: ["+n+"] under the key: ["+e+"]"),e=O(e,r.maxKeyLength,"userData max",i),n=O(n,r.maxValueSize,"userData max",i),de(e,n,"$max")},min:function(e,n){i(t.INFO,"min, Saving user's minimum custom property value compared to the value: ["+n+"] under the key: ["+e+"]"),e=O(e,r.maxKeyLength,"userData min",i),n=O(n,r.maxValueSize,"userData min",i),de(e,n,"$min")},push:function(e,n){i(t.INFO,"push, Pushing a value: ["+n+"] under the key: ["+e+"] to user's custom property array"),e=O(e,r.maxKeyLength,"userData push",i),n=O(n,r.maxValueSize,"userData push",i),de(e,n,"$push")},push_unique:function(e,n){i(t.INFO,"push_unique, Pushing a unique value: ["+n+"] under the key: ["+e+"] to user's custom property array"),e=O(e,r.maxKeyLength,"userData push_unique",i),n=O(n,r.maxValueSize,"userData push_unique",i),de(e,n,"$addToSet")},pull:function(e,n){i(t.INFO,"pull, Removing the value: ["+n+"] under the key: ["+e+"] from user's custom property array"),de(e,n,"$pull")},save:function(){i(t.INFO,"save, Saving changes to user's custom property"),r.check_consent(c.USERS)&&W({user_details:JSON.stringify({custom:ie})}),ie={}}},this.report_trace=function(e){if(i(t.INFO,"report_trace, Reporting performance trace"),this.check_consent(c.APM)){for(var n=["type","name","stz","etz","apm_metrics","apm_attr"],s=0;s<n.length;s++)if(n[s]!=="apm_attr"&&typeof e[n[s]]>"u"){i(t.WARNING,"report_trace, APM trace don't have the property: "+n[s]);return}e.name=O(e.name,r.maxKeyLength,"report_trace",i),e.app_metrics=ae(e.app_metrics,r.maxKeyLength,r.maxValueSize,r.maxSegmentationValues,"report_trace",i);var f=Ee(e,n);f.timestamp=e.stz;var p=new Date;f.hour=p.getHours(),f.dow=p.getDay(),W({apm:JSON.stringify(f)}),i(t.INFO,"report_trace, Successfully adding APM trace: ",f)}},this.track_errors=function(e){i(t.INFO,"track_errors, Started tracking errors"),a.i[this.app_key].tracking_crashes=!0,window.cly_crashes||(window.cly_crashes=!0,it=e,window.onerror=function n(s,f,p,l,u){if(u!=null)Ze(u,!1);else{l=l||window.event&&window.event.errorCharacter;var d="";typeof s<"u"&&(d+=s+`
`),typeof f<"u"&&(d+="at "+f),typeof p<"u"&&(d+=":"+p),typeof l<"u"&&(d+=":"+l),d+=`
`;try{for(var _=[],m=n.caller;m;)_.push(m.name),m=m.caller;d+=_.join(`
`)}catch(R){i(t.ERROR,"track_errors, Call stack generation experienced a problem: "+R)}Ze(d,!1)}},window.addEventListener("unhandledrejection",function(n){Ze(new Error("Unhandled rejection (reason: "+(n.reason&&n.reason.stack?n.reason.stack:n.reason)+")."),!0)}))},this.log_error=function(e,n){i(t.INFO,"log_error, Logging errors"),this.recordError(e,!0,n)},this.add_log=function(e){if(i(t.INFO,"add_log, Adding a new log of breadcrumbs: [ "+e+" ]"),this.check_consent(c.CRASHES)){for(e=O(e,r.maxValueSize,"add_log",i);oe.length>=r.maxBreadcrumbCount;)oe.shift(),i(t.WARNING,"add_log, Reached maximum crashLogs size. Will erase the oldest one.");oe.push(e)}},this.fetch_remote_config=function(e,n,s){var f=null,p=null,l=null;if(e&&(!s&&typeof e=="function"?l=e:Array.isArray(e)&&(f=e)),n&&(!s&&typeof n=="function"?l=n:Array.isArray(n)&&(p=n)),!l&&typeof s=="function"&&(l=s),this.useExplicitRcApi){i(t.INFO,"fetch_remote_config, Fetching remote config");var u=this.rcAutoOptinAb?1:0;Ct(f,p,u,null,l);return}i(t.WARNING,"fetch_remote_config, Fetching remote config, with legacy API"),Ct(f,p,null,"legacy",l)};function Ct(e,n,s,f,p){i(t.INFO,"fetch_remote_config_explicit, Fetching sequence initiated");var l={method:"rc"};e&&(l.keys=JSON.stringify(e)),n&&(l.omit_keys=JSON.stringify(n));var u;f==="legacy"&&(l.method="fetch_remote_config"),s===0&&(l.oi=0),s===1&&(l.oi=1),typeof p=="function"&&(u=p),r.check_consent(c.SESSIONS)&&(l.metrics=JSON.stringify(Fe())),r.check_consent(c.REMOTE_CONFIG)?(dt(l),le("fetch_remote_config_explicit",r.url+K,l,function(d,_,m){if(d){i(t.ERROR,"fetch_remote_config_explicit, An error occurred: "+d);return}try{var R=JSON.parse(m);if(l.keys||l.omit_keys)for(var A in R)M[A]=R[A];else M=R;S("cly_remote_configs",M)}catch(D){i(t.ERROR,"fetch_remote_config_explicit, Had an issue while parsing the response: "+D)}u&&(i(t.INFO,"fetch_remote_config_explicit, Callback function is provided"),u(d,M))},!0)):(i(t.ERROR,"fetch_remote_config_explicit, Remote config requires explicit consent"),u&&u(new Error("Remote config requires explicit consent"),M))}this.enrollUserToAb=function(e){if(i(t.INFO,"enrollUserToAb, Providing AB test keys to opt in for"),!e||!Array.isArray(e)||e.length===0){i(t.ERROR,"enrollUserToAb, No keys provided");return}var n={method:"ab",keys:JSON.stringify(e)};dt(n),le("enrollUserToAb",this.url+K,n,function(s,f,p){if(s){i(t.ERROR,"enrollUserToAb, An error occurred: "+s);return}try{var l=JSON.parse(p);i(t.DEBUG,"enrollUserToAb, Parsed the response's result: ["+l.result+"]")}catch(u){i(t.ERROR,"enrollUserToAb, Had an issue while parsing the response: "+u)}},!0)},this.get_remote_config=function(e){return i(t.INFO,"get_remote_config, Getting remote config from storage"),typeof e<"u"?M[e]:M},this.stop_time=function(){i(t.INFO,"stop_time, Stopping tracking duration"),pe&&(pe=!1,nt=U()-fe,Ie=U()-Se)},this.start_time=function(){i(t.INFO,"start_time, Starting tracking duration"),pe||(pe=!0,fe=U()-nt,Se=U()-Ie,Ie=0,Pt())},this.track_sessions=function(){i(t.INFO,"track_session, Starting tracking user session"),this.begin_session(),this.start_time(),N(window,"beforeunload",function(){ot(),r.end_session()});var e="hidden";function n(){document[e]||!document.hasFocus()?r.stop_time():r.start_time()}N(window,"focus",n),N(window,"blur",n),N(window,"pageshow",n),N(window,"pagehide",n),"onfocusin"in document&&(N(window,"focusin",n),N(window,"focusout",n)),e in document?document.addEventListener("visibilitychange",n):"mozHidden"in document?(e="mozHidden",document.addEventListener("mozvisibilitychange",n)):"webkitHidden"in document?(e="webkitHidden",document.addEventListener("webkitvisibilitychange",n)):"msHidden"in document&&(e="msHidden",document.addEventListener("msvisibilitychange",n));function s(){Ne>=Oe&&r.start_time(),Ne=0}N(window,"mousemove",s),N(window,"click",s),N(window,"keydown",s),N(window,"scroll",s),setInterval(function(){Ne++,Ne>=Oe&&r.stop_time()},6e4)},this.track_pageview=function(e,n,s){if(i(t.INFO,"track_pageview, Tracking page views"),i(t.VERBOSE,"track_pageview, last view is:["+te+"]"),te&&(i(t.DEBUG,"track_pageview, Scroll registry triggered"),ft(),xe=!0,Ae=0),ct(),e=O(e,r.maxKeyLength,"track_pageview",i),e&&Array.isArray(e)&&(n=e,e=null),e||(e=this.getViewName()),e===void 0||e===""){i(t.ERROR,"track_pageview, No page name to track (it is either undefined or empty string). No page view can be tracked.");return}if(e===null){i(t.ERROR,"track_pageview, View name returned as null. Page view will be ignored.");return}if(n&&n.length)for(var f=0;f<n.length;f++)try{var p=new RegExp(n[f]);if(p.test(e)){i(t.INFO,"track_pageview, Ignoring the page: "+e);return}}catch(m){i(t.ERROR,"track_pageview, Problem with finding ignore list item: "+n[f]+", error: "+m)}te=e,Se=U(),i(t.VERBOSE,"track_pageview, last view is assigned:["+te+"]");var l={name:e,visit:1,view:r.getViewUrl()};if(l=ae(l,r.maxKeyLength,r.maxValueSize,r.maxSegmentationValues,"track_pageview",i),this.track_domains&&(l.domain=window.location.hostname),ue)if(w)ye&&(ye=!1,l.start=1);else{var u=k("cly_session");(!u||parseInt(u)<=U())&&(ye=!1,l.start=1)}else if(typeof document.referrer<"u"&&document.referrer.length){var d=C.exec(document.referrer);d&&d[11]&&d[11]!==window.location.hostname&&(l.start=1)}if(s){s=ae(s,r.maxKeyLength,r.maxValueSize,r.maxSegmentationValues,"track_pageview",i);for(var _ in s)typeof l[_]>"u"&&(l[_]=s[_])}this.check_consent(c.VIEWS)?X({key:g.VIEW,segmentation:l}):ce.track_pageview=arguments},this.track_view=function(e,n,s){i(t.INFO,"track_view, Initiating tracking page views"),this.track_pageview(e,n,s)},this.track_clicks=function(e){i(t.INFO,"track_clicks, Starting to track clicks"),e&&i(t.INFO,"track_clicks, Tracking the specified children:["+e+"]"),e=e||document;var n=!0;function s(f){if(n){if(n=!1,et(f),typeof f.pageX<"u"&&typeof f.pageY<"u"){var p=Ce(),l=tt();if(r.check_consent(c.CLICKS)){var u={type:"click",x:f.pageX,y:f.pageY,width:l,height:p,view:r.getViewUrl()};u=ae(u,r.maxKeyLength,r.maxValueSize,r.maxSegmentationValues,"processClick",i),r.track_domains&&(u.domain=window.location.hostname),X({key:g.ACTION,segmentation:u})}}setTimeout(function(){n=!0},1e3)}}N(e,"click",s)},this.track_scrolls=function(e){i(t.INFO,"track_scrolls, Starting to track scrolls"),e&&i(t.INFO,"track_scrolls, Tracking the specified children"),e=e||window,xe=!0,N(e,"scroll",Gt),N(e,"beforeunload",ft)},this.track_links=function(e){i(t.INFO,"track_links, Starting to track clicks to links"),e&&i(t.INFO,"track_links, Tracking the specified children"),e=e||document;function n(s){var f=oi(Le(s),"a");f&&(et(s),r.check_consent(c.CLICKS)&&X({key:"linkClick",segmentation:{href:f.href,text:f.innerText,id:f.id,view:r.getViewUrl()}}))}N(e,"click",n)},this.track_forms=function(e,n){i(t.INFO,"track_forms, Starting to track form submissions. DOM object provided:["+!!e+"] Tracking hidden inputs :["+!!n+"]"),e=e||document;function s(p){return p.name||p.id||p.type||p.nodeName}function f(p){var l=Le(p),u={id:l.attributes.id&&l.attributes.id.nodeValue,name:l.attributes.name&&l.attributes.name.nodeValue,action:l.attributes.action&&l.attributes.action.nodeValue,method:l.attributes.method&&l.attributes.method.nodeValue,view:r.getViewUrl()},d;if(typeof l.elements<"u"){for(var _=0;_<l.elements.length;_++)d=l.elements[_],d&&d.type!=="password"&&d.className.indexOf("cly_user_ignore")===-1&&(typeof u["input:"+s(d)]>"u"&&(u["input:"+s(d)]=[]),d.nodeName.toLowerCase()==="select"?typeof d.multiple<"u"?u["input:"+s(d)].push(Rt(d)):u["input:"+s(d)].push(d.options[d.selectedIndex].value):d.nodeName.toLowerCase()==="input"?typeof d.type<"u"?d.type.toLowerCase()==="checkbox"||d.type.toLowerCase()==="radio"?d.checked&&u["input:"+s(d)].push(d.value):(d.type.toLowerCase()!=="hidden"||n)&&u["input:"+s(d)].push(d.value):u["input:"+s(d)].push(d.value):(d.nodeName.toLowerCase()==="textarea"||typeof d.value<"u")&&u["input:"+s(d)].push(d.value));for(var m in u)u[m]&&typeof u[m].join=="function"&&(u[m]=u[m].join(", "))}r.check_consent(c.FORMS)&&X({key:"formSubmit",segmentation:u})}N(e,"submit",f)},this.collect_from_forms=function(e,n){i(t.INFO,"collect_from_forms, Starting to collect possible user data. DOM object provided:["+!!e+"] Submitting custom user property:["+!!n+"]"),e=e||document;function s(f){var p=Le(f),l={},u=!1,d;if(typeof p.elements<"u"){var _={},m=e.getElementsByTagName("LABEL"),R,A;for(R=0;R<m.length;R++)m[R].htmlFor&&m[R].htmlFor!==""&&(_[m[R].htmlFor]=m[R].innerText||m[R].textContent||m[R].innerHTML);for(R=0;R<p.elements.length;R++)if(d=p.elements[R],d&&d.type!=="password"&&d.className.indexOf("cly_user_ignore")===-1){var D="";if(d.nodeName.toLowerCase()==="select"?typeof d.multiple<"u"?D=Rt(d):D=d.options[d.selectedIndex].value:d.nodeName.toLowerCase()==="input"?typeof d.type<"u"&&(d.type.toLowerCase()==="checkbox"||d.type.toLowerCase()==="radio")?d.checked&&(D=d.value):D=d.value:(d.nodeName.toLowerCase()==="textarea"||typeof d.value<"u")&&(D=d.value),d.className&&d.className.indexOf("cly_user_")!==-1){var $=d.className.split(" ");for(A=0;A<$.length;A++)if($[A].indexOf("cly_user_")===0){l[$[A].replace("cly_user_","")]=D,u=!0;break}}else d.type&&d.type.toLowerCase()==="email"||d.name&&d.name.toLowerCase().indexOf("email")!==-1||d.id&&d.id.toLowerCase().indexOf("email")!==-1||d.id&&_[d.id]&&_[d.id].toLowerCase().indexOf("email")!==-1||/[^@\s]+@[^@\s]+\.[^@\s]+/.test(D)?(l.email||(l.email=D),u=!0):d.name&&d.name.toLowerCase().indexOf("username")!==-1||d.id&&d.id.toLowerCase().indexOf("username")!==-1||d.id&&_[d.id]&&_[d.id].toLowerCase().indexOf("username")!==-1?(l.username||(l.username=D),u=!0):d.name&&(d.name.toLowerCase().indexOf("tel")!==-1||d.name.toLowerCase().indexOf("phone")!==-1||d.name.toLowerCase().indexOf("number")!==-1)||d.id&&(d.id.toLowerCase().indexOf("tel")!==-1||d.id.toLowerCase().indexOf("phone")!==-1||d.id.toLowerCase().indexOf("number")!==-1)||d.id&&_[d.id]&&(_[d.id].toLowerCase().indexOf("tel")!==-1||_[d.id].toLowerCase().indexOf("phone")!==-1||_[d.id].toLowerCase().indexOf("number")!==-1)?(l.phone||(l.phone=D),u=!0):d.name&&(d.name.toLowerCase().indexOf("org")!==-1||d.name.toLowerCase().indexOf("company")!==-1)||d.id&&(d.id.toLowerCase().indexOf("org")!==-1||d.id.toLowerCase().indexOf("company")!==-1)||d.id&&_[d.id]&&(_[d.id].toLowerCase().indexOf("org")!==-1||_[d.id].toLowerCase().indexOf("company")!==-1)?(l.organization||(l.organization=D),u=!0):(d.name&&d.name.toLowerCase().indexOf("name")!==-1||d.id&&d.id.toLowerCase().indexOf("name")!==-1||d.id&&_[d.id]&&_[d.id].toLowerCase().indexOf("name")!==-1)&&(l.name||(l.name=""),l.name+=D+" ",u=!0)}}u&&(i(t.INFO,"collect_from_forms, Gathered user data",l),n?r.user_details({custom:l}):r.user_details(l))}N(e,"submit",s)},this.collect_from_facebook=function(e){i(t.INFO,"collect_from_facebook, Starting to collect possible user data"),FB&&FB.api&&FB.api("/me",function(n){var s={};if(n.name&&(s.name=n.name),n.email&&(s.email=n.email),n.gender==="male"?s.gender="M":n.gender==="female"&&(s.gender="F"),n.birthday){var f=n.birthday.split("/").pop();f&&f.length===4&&(s.byear=f)}if(n.work&&n.work[0]&&n.work[0].employer&&n.work[0].employer.name&&(s.organization=n.work[0].employer.name),e){s.custom={};for(var p in e){for(var l=e[p].split("."),u=n,d=0;d<l.length&&(u=u[l[d]],!(typeof u>"u"));d++);typeof u<"u"&&(s.custom[p]=u)}}r.user_details(s)})},this.opt_out=function(){i(t.INFO,"opt_out, Opting out the user"),this.ignore_visitor=!0,S("cly_ignore",!0)},this.opt_in=function(){i(t.INFO,"opt_in, Opting in the user"),S("cly_ignore",!1),this.ignore_visitor=!1,Bt(),!this.ignore_visitor&&!Ve&&Me()},this.report_feedback=function(e){i(t.WARNING,"report_feedback, Deprecated function call! Use 'recordRatingWidgetWithID' or 'reportFeedbackWidgetManually' in place of this call. Call will be redirected to 'recordRatingWidgetWithID' now!"),this.recordRatingWidgetWithID(e)},this.recordRatingWidgetWithID=function(e){if(i(t.INFO,"recordRatingWidgetWithID, Providing information about user with ID: [ "+e.widget_id+" ]"),!!this.check_consent(c.STAR_RATING)){if(!e.widget_id){i(t.ERROR,"recordRatingWidgetWithID, Rating Widget must contain widget_id property");return}if(!e.rating){i(t.ERROR,"recordRatingWidgetWithID, Rating Widget must contain rating property");return}var n=["widget_id","contactMe","platform","app_version","rating","email","comment"],s={key:g.STAR_RATING,count:1,segmentation:{}};s.segmentation=Ee(e,n),s.segmentation.app_version||(s.segmentation.app_version=this.metrics._app_version||this.app_version),s.segmentation.rating>5?(i(t.WARNING,"recordRatingWidgetWithID, You have entered a rating higher than 5. Changing it back to 5 now."),s.segmentation.rating=5):s.segmentation.rating<1&&(i(t.WARNING,"recordRatingWidgetWithID, You have entered a rating lower than 1. Changing it back to 1 now."),s.segmentation.rating=1),i(t.INFO,"recordRatingWidgetWithID, Reporting Rating Widget: ",s),X(s)}},this.reportFeedbackWidgetManually=function(e,n,s){if(!!this.check_consent(c.FEEDBACK)){if(!(e&&n)){i(t.ERROR,"reportFeedbackWidgetManually, Widget data and/or Widget object not provided. Aborting.");return}if(!e._id){i(t.ERROR,"reportFeedbackWidgetManually, Feedback Widgets must contain _id property");return}if(G){i(t.ERROR,"reportFeedbackWidgetManually, Feedback Widgets can not be reported in offline mode");return}i(t.INFO,"reportFeedbackWidgetManually, Providing information about user with, provided result of the widget with  ID: [ "+e._id+" ] and type: ["+e.type+"]");var f=[],p=e.type,l;if(p==="nps"){if(s){if(!s.rating){i(t.ERROR,"reportFeedbackWidgetManually, Widget must contain rating property");return}s.rating=Math.round(s.rating),s.rating>10?(i(t.WARNING,"reportFeedbackWidgetManually, You have entered a rating higher than 10. Changing it back to 10 now."),s.rating=10):s.rating<0&&(i(t.WARNING,"reportFeedbackWidgetManually, You have entered a rating lower than 0. Changing it back to 0 now."),s.rating=0),f=["rating","comment"]}l=g.NPS}else if(p==="survey"){if(s){if(Object.keys(s).length<1){i(t.ERROR,"reportFeedbackWidgetManually, Widget should have answers to be reported");return}f=Object.keys(s)}l=g.SURVEY}else if(p==="rating"){if(s){if(!s.rating){i(t.ERROR,"reportFeedbackWidgetManually, Widget must contain rating property");return}s.rating=Math.round(s.rating),s.rating>5?(i(t.WARNING,"reportFeedbackWidgetManually, You have entered a rating higher than 5. Changing it back to 5 now."),s.rating=5):s.rating<1&&(i(t.WARNING,"reportFeedbackWidgetManually, You have entered a rating lower than 1. Changing it back to 1 now."),s.rating=1),f=["rating","comment","email","contactMe"]}l=g.STAR_RATING}else{i(t.ERROR,"reportFeedbackWidgetManually, Widget has an unacceptable type");return}var u={key:l,count:1,segmentation:{widget_id:e._id,platform:this.platform,app_version:this.metrics._app_version||this.app_version}};s===null?u.segmentation.closed=1:u.segmentation=ai(u.segmentation,s,f),i(t.INFO,"reportFeedbackWidgetManually, Reporting "+p+": ",u),X(u)}},this.show_feedback_popup=function(e){i(t.WARNING,"show_feedback_popup, Deprecated function call! Use 'presentRatingWidgetWithID' in place of this call. Call will be redirected now!"),this.presentRatingWidgetWithID(e)},this.presentRatingWidgetWithID=function(e){i(t.INFO,"presentRatingWidgetWithID, Showing rating widget popup for the widget with ID: [ "+e+" ]"),this.check_consent(c.STAR_RATING)&&(G?i(t.ERROR,"presentRatingWidgetWithID, Cannot show ratingWidget popup in offline mode"):le("presentRatingWidgetWithID",this.url+"/o/feedback/widget",{widget_id:e},function(n,s,f){if(n){i(t.ERROR,"presentRatingWidgetWithID, An error occurred: "+n);return}try{var p=JSON.parse(f);st(p,!1)}catch(l){i(t.ERROR,"presentRatingWidgetWithID, JSON parse failed: "+l)}},!0))},this.initialize_feedback_popups=function(e){i(t.WARNING,"initialize_feedback_popups, Deprecated function call! Use 'initializeRatingWidgets' in place of this call. Call will be redirected now!"),this.initializeRatingWidgets(e)},this.initializeRatingWidgets=function(e){if(i(t.INFO,"initializeRatingWidgets, Initializing rating widget with provided widget IDs:[ "+e+"]"),!!this.check_consent(c.STAR_RATING)){e||(e=k("cly_fb_widgets"));for(var n=document.getElementsByClassName("countly-feedback-sticker");n.length>0;)n[0].remove();le("initializeRatingWidgets",this.url+"/o/feedback/multiple-widgets-by-id",{widgets:JSON.stringify(e)},function(s,f,p){if(s){i(t.ERROR,"initializeRatingWidgets, An error occurred: "+s);return}try{for(var l=JSON.parse(p),u=0;u<l.length;u++)if(l[u].is_active==="true"){var d=l[u].target_devices,_=Ot();if(d[_])if(typeof l[u].hide_sticker=="string"&&(l[u].hide_sticker=l[u].hide_sticker==="true"),l[u].target_page==="all"&&!l[u].hide_sticker)st(l[u],!0);else for(var m=l[u].target_pages,R=0;R<m.length;R++){var A=m[R].substr(0,m[R].length-1)===window.location.pathname.substr(0,m[R].length-1),D=m[R]===window.location.pathname,$=m[R].includes("*");($&&A||D)&&!l[u].hide_sticker&&st(l[u],!0)}}}catch(F){i(t.ERROR,"initializeRatingWidgets, JSON parse error: "+F)}},!0)}},this.enable_feedback=function(e){i(t.WARNING,"enable_feedback, Deprecated function call! Use 'enableRatingWidgets' in place of this call. Call will be redirected now!"),this.enableRatingWidgets(e)},this.enableRatingWidgets=function(e){if(i(t.INFO,"enableRatingWidgets, Enabling rating widget with params:",e),!!this.check_consent(c.STAR_RATING))if(G)i(t.ERROR,"enableRatingWidgets, Cannot enable rating widgets in offline mode");else{S("cly_fb_widgets",e.popups||e.widgets),Be(this.url+"/star-rating/stylesheets/countly-feedback-web.css");var n=e.popups||e.widgets;n.length>0?(document.body.insertAdjacentHTML("beforeend",'<div id="cfbg"></div>'),this.initializeRatingWidgets(n)):i(t.ERROR,"enableRatingWidgets, You should provide at least one widget id as param. Read documentation for more detail. https://resources.count.ly/plugins/feedback")}},this.get_available_feedback_widgets=function(e){if(i(t.INFO,"get_available_feedback_widgets, Getting the feedback list, callback function is provided:["+!!e+"]"),!this.check_consent(c.FEEDBACK)){e&&e(null,new Error("Consent for feedback not provided."));return}if(G){i(t.ERROR,"get_available_feedback_widgets, Cannot enable feedback widgets in offline mode.");return}var n=this.url+K,s={method:c.FEEDBACK,device_id:this.device_id,app_key:this.app_key};le("get_available_feedback_widgets",n,s,function(f,p,l){if(f){i(t.ERROR,"get_available_feedback_widgets, Error occurred while fetching feedbacks: "+f),e&&e(null,f);return}try{var u=JSON.parse(l),d=u.result||[];e&&e(d,null);return}catch(_){i(t.ERROR,"get_available_feedback_widgets, Error while parsing feedback widgets list: "+_),e&&e(null,_)}},!1)},this.getFeedbackWidgetData=function(e,n){if(!e.type){i(t.ERROR,"getFeedbackWidgetData, Expected the provided widget object to have a type but got: ["+JSON.stringify(e)+"], aborting.");return}if(i(t.INFO,"getFeedbackWidgetData, Retrieving data for: ["+JSON.stringify(e)+"], callback function is provided:["+!!n+"]"),!this.check_consent(c.FEEDBACK)){n&&n(null,new Error("Consent for feedback not provided."));return}if(G){i(t.ERROR,"getFeedbackWidgetData, Cannot enable feedback widgets in offline mode.");return}var s=this.url,f={widget_id:e._id,shown:1,sdk_version:x,sdk_name:L,platform:this.platform,app_version:this.app_version};if(e.type==="nps")s+="/o/surveys/nps/widget";else if(e.type==="survey")s+="/o/surveys/survey/widget";else if(e.type==="rating")s+="/o/surveys/rating/widget";else{i(t.ERROR,"getFeedbackWidgetData, Unknown type info: ["+e.type+"]");return}le("getFeedbackWidgetData",s,f,p,!0);function p(l,u,d){if(l){i(t.ERROR,"getFeedbackWidgetData, Error occurred while fetching feedbacks: "+l),n&&n(null,l);return}try{var _=JSON.parse(d);n&&n(_,null);return}catch(m){i(t.ERROR,"getFeedbackWidgetData, Error while parsing feedback widgets list: "+m),n&&n(null,m)}}},this.present_feedback_widget=function(e,n,s){if(i(t.INFO,"present_feedback_widget, Presenting the feedback widget by appending to the element with ID: [ "+n+" ] and className: [ "+s+" ]"),!this.check_consent(c.FEEDBACK))return;if(!e||typeof e!="object"||Array.isArray(e)){i(t.ERROR,"present_feedback_widget, Please provide at least one feedback widget object.");return}try{var f=this.url;if(e.type==="nps")i(t.DEBUG,"present_feedback_widget, Widget type: nps."),f+="/feedback/nps";else if(e.type==="survey")i(t.DEBUG,"present_feedback_widget, Widget type: survey."),f+="/feedback/survey";else if(e.type==="rating")i(t.DEBUG,"present_feedback_widget, Widget type: rating."),f+="/feedback/rating";else{i(t.ERROR,"present_feedback_widget, Feedback widget only accepts nps, rating and survey types.");return}var p=window.origin||window.location.origin,l;e.type==="rating"?(i(t.DEBUG,"present_feedback_widget, Loading css for rating widget."),l="ratings",Be(this.url+"/star-rating/stylesheets/countly-feedback-web.css")):(i(t.DEBUG,"present_feedback_widget, Loading css for survey or nps."),Be(this.url+"/surveys/stylesheets/countly-surveys.css"),l="surveys"),f+="?widget_id="+e._id,f+="&app_key="+this.app_key,f+="&device_id="+this.device_id,f+="&sdk_name="+L,f+="&platform="+this.platform,f+="&app_version="+this.app_version,f+="&sdk_version="+x,f+="&origin="+p,f+="&widget_v=web";var u=document.createElement("iframe");u.src=f,u.name="countly-"+l+"-iframe",u.id="countly-"+l+"-iframe";var d=!1;u.onload=function(){d&&(document.getElementById("countly-"+l+"-wrapper-"+e._id).style.display="none",document.getElementById("csbg").style.display="none"),d=!0,i(t.DEBUG,"present_feedback_widget, Loaded iframe.")};for(var _=document.getElementById("csbg");_;)_.remove(),_=document.getElementById("csbg"),i(t.DEBUG,"present_feedback_widget, Removing past overlay.");for(var m=document.getElementsByClassName("countly-"+l+"-wrapper"),R=0;R<m.length;R++)m[R].remove(),i(t.DEBUG,"present_feedback_widget, Removed a wrapper.");m=document.createElement("div"),m.className="countly-"+l+"-wrapper",m.id="countly-"+l+"-wrapper-"+e._id,e.type==="survey"&&(m.className=m.className+" "+e.appearance.position);var A=document.body,D=!1;if(n&&(document.getElementById(n)?(A=document.getElementById(n),D=!0):i(t.ERROR,"present_feedback_widget, Provided ID not found.")),D||s&&(document.getElementsByClassName(s)[0]?A=document.getElementsByClassName(s)[0]:i(t.ERROR,"present_feedback_widget, Provided class not found.")),A.insertAdjacentHTML("beforeend",'<div id="csbg"></div>'),A.appendChild(m),e.type==="rating"){var $=document.createElement("div");$.className="countly-ratings-overlay",$.id="countly-ratings-overlay-"+e._id,m.appendChild($),i(t.DEBUG,"present_feedback_widget, appended the rating overlay to wrapper"),N(document.getElementById("countly-ratings-overlay-"+e._id),"click",function(){document.getElementById("countly-ratings-wrapper-"+e._id).style.display="none"})}if(m.appendChild(u),i(t.DEBUG,"present_feedback_widget, Appended the iframe"),N(window,"message",function(b){var q={};try{q=JSON.parse(b.data),i(t.DEBUG,"present_feedback_widget, Parsed response message "+q)}catch(gi){i(t.ERROR,"present_feedback_widget, Error while parsing message body "+gi)}if(!q.close){i(t.DEBUG,"present_feedback_widget, Closing signal not sent yet");return}document.getElementById("countly-"+l+"-wrapper-"+e._id).style.display="none",document.getElementById("csbg").style.display="none"}),e.type==="survey"){var F=!1;switch(e.showPolicy){case"afterPageLoad":document.readyState==="complete"?F||(F=!0,me(e)):N(document,"readystatechange",function(b){b.target.readyState==="complete"&&(F||(F=!0,me(e)))});break;case"afterConstantDelay":setTimeout(function(){F||(F=!0,me(e))},1e4);break;case"onAbandon":document.readyState==="complete"?N(document,"mouseleave",function(){F||(F=!0,me(e))}):N(document,"readystatechange",function(b){b.target.readyState==="complete"&&N(document,"mouseleave",function(){F||(F=!0,me(e))})});break;case"onScrollHalfwayDown":N(window,"scroll",function(){if(!F){var b=Math.max(window.scrollY,document.body.scrollTop,document.documentElement.scrollTop),q=Ce();b>=q/2&&(F=!0,me(e))}});break;default:F||(F=!0,me(e))}}else if(e.type==="nps")document.getElementById("countly-"+l+"-wrapper-"+e._id).style.display="block",document.getElementById("csbg").style.display="block";else if(e.type==="rating"){var We=!1;document.readyState==="complete"?We||(We=!0,Wt(e)):N(document,"readystatechange",function(b){b.target.readyState==="complete"&&(We||(We=!0,Wt(e)))})}}catch(b){i(t.ERROR,"present_feedback_widget, Something went wrong while presenting the widget: "+b)}function me(b){document.getElementById("countly-surveys-wrapper-"+b._id).style.display="block",document.getElementById("csbg").style.display="block"}function Wt(b){if(!b.appearance.hideS){i(t.DEBUG,"present_feedback_widget, handling the sticker as it was not set to hidden");var q=document.createElement("div");q.innerText=b.appearance.text,q.style.color=b.appearance.text_color.length<7?"#"+b.appearance.text_color:b.appearance.text_color,q.style.backgroundColor=b.appearance.bg_color.length<7?"#"+b.appearance.bg_color:b.appearance.bg_color,q.className="countly-feedback-sticker  "+b.appearance.position+"-"+b.appearance.size,q.id="countly-feedback-sticker-"+b._id,document.body.appendChild(q),N(document.getElementById("countly-feedback-sticker-"+b._id),"click",function(){document.getElementById("countly-ratings-wrapper-"+b._id).style.display="flex",document.getElementById("csbg").style.display="block"})}N(document.getElementById("countly-feedback-close-icon-"+b._id),"click",function(){document.getElementById("countly-ratings-wrapper-"+b._id).style.display="none",document.getElementById("csbg").style.display="none"})}},this.recordError=function(e,n,s){if(i(t.INFO,"recordError, Recording error"),this.check_consent(c.CRASHES)&&e){s=s||it;var f="";if(typeof e=="object"?typeof e.stack<"u"?f=e.stack:(typeof e.name<"u"&&(f+=e.name+":"),typeof e.message<"u"&&(f+=e.message+`
`),typeof e.fileName<"u"&&(f+="in "+e.fileName+`
`),typeof e.lineNumber<"u"&&(f+="on "+e.lineNumber),typeof e.columnNumber<"u"&&(f+=":"+e.columnNumber)):f=e+"",f.length>r.maxStackTraceLineLength*r.maxStackTraceLinesPerThread){i(t.DEBUG,"record_error, Error stack is too long will be truncated");var p=f.split(`
`);p.length>r.maxStackTraceLinesPerThread&&(p=p.splice(0,r.maxStackTraceLinesPerThread));for(var l=0,u=p.length;l<u;l++)p[l].length>r.maxStackTraceLineLength&&(p[l]=p[l].substring(0,r.maxStackTraceLineLength));f=p.join(`
`)}n=!!n;var d=Fe(),_={_resolution:d._resolution,_error:f,_app_version:d._app_version,_run:U()-Dt};_._not_os_specific=!0,_._javascript=!0;var m=navigator.battery||navigator.webkitBattery||navigator.mozBattery||navigator.msBattery;m&&(_._bat=Math.floor(m.level*100)),typeof navigator.onLine<"u"&&(_._online=!!navigator.onLine),_._background=!document.hasFocus(),oe.length>0&&(_._logs=oe.join(`
`)),oe=[],_._nonfatal=n,_._view=this.getViewName(),typeof s<"u"&&(s=ae(s,r.maxKeyLength,r.maxValueSize,r.maxSegmentationValues,"record_error",i),_._custom=s);try{var R=document.createElement("canvas"),A=R.getContext("experimental-webgl");_._opengl=A.getParameter(A.VERSION)}catch($){i(t.ERROR,"Could not get the experimental-webgl context: "+$)}var D={};D.crash=JSON.stringify(_),D.metrics=JSON.stringify({_ua:d._ua}),W(D)}};function Bt(){r.ignore_prefetch&&typeof document.visibilityState<"u"&&document.visibilityState==="prerender"&&(r.ignore_visitor=!0),r.ignore_bots&&Nt()&&(r.ignore_visitor=!0)}function ot(){z.length>0&&(W({events:JSON.stringify(z)}),z=[],S("cly_event",z))}function st(e,n){var s=!!document.getElementById("countly-feedback-sticker-"+e._id);if(s){i(t.ERROR,"Widget with same ID exists");return}try{var f=document.createElement("div");f.className="countly-iframe-wrapper",f.id="countly-iframe-wrapper-"+e._id;var p=document.createElement("span");p.className="countly-feedback-close-icon",p.id="countly-feedback-close-icon-"+e._id,p.innerText="x";var l=document.createElement("iframe");if(l.name="countly-feedback-iframe",l.id="countly-feedback-iframe",l.src=r.url+"/feedback?widget_id="+e._id+"&app_key="+r.app_key+"&device_id="+r.device_id+"&sdk_version="+x,document.body.appendChild(f),f.appendChild(p),f.appendChild(l),N(document.getElementById("countly-feedback-close-icon-"+e._id),"click",function(){document.getElementById("countly-iframe-wrapper-"+e._id).style.display="none",document.getElementById("cfbg").style.display="none"}),n){var u=document.createElementNS("http://www.w3.org/2000/svg","svg");u.id="feedback-sticker-svg",u.setAttribute("aria-hidden","true"),u.setAttribute("data-prefix","far"),u.setAttribute("data-icon","grin"),u.setAttribute("class","svg-inline--fa fa-grin fa-w-16"),u.setAttribute("role","img"),u.setAttribute("xmlns","http://www.w3.org/2000/svg"),u.setAttribute("viewBox","0 0 496 512");var d=document.createElementNS("http://www.w3.org/2000/svg","path");d.id="smileyPathInStickerSvg",d.setAttribute("fill","white"),d.setAttribute("d","M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-110.3 0-200-89.7-200-200S137.7 56 248 56s200 89.7 200 200-89.7 200-200 200zm105.6-151.4c-25.9 8.3-64.4 13.1-105.6 13.1s-79.6-4.8-105.6-13.1c-9.9-3.1-19.4 5.4-17.7 15.3 7.9 47.1 71.3 80 123.3 80s115.3-32.9 123.3-80c1.6-9.8-7.7-18.4-17.7-15.3zM168 240c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm160 0c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32z");var _=document.createElement("span");_.innerText=e.trigger_button_text;var m=document.createElement("div");m.style.color=e.trigger_font_color.length<7?"#"+e.trigger_font_color:e.trigger_font_color,m.style.backgroundColor=e.trigger_bg_color.length<7?"#"+e.trigger_bg_color:e.trigger_bg_color,m.className="countly-feedback-sticker  "+e.trigger_position+"-"+e.trigger_size,m.id="countly-feedback-sticker-"+e._id,u.appendChild(d),m.appendChild(u),m.appendChild(_),document.body.appendChild(m);var R=document.getElementById("smileyPathInStickerSvg");R&&(R.style.fill=e.trigger_font_color.length<7?"#"+e.trigger_font_color:e.trigger_font_color),N(document.getElementById("countly-feedback-sticker-"+e._id),"click",function(){document.getElementById("countly-iframe-wrapper-"+e._id).style.display="block",document.getElementById("cfbg").style.display="block"})}else document.getElementById("countly-iframe-wrapper-"+e._id).style.display="block",document.getElementById("cfbg").style.display="block"}catch(A){i(t.ERROR,"Somethings went wrong while element injecting process: "+A)}}function Ut(){var e;if(typeof r.onload<"u"&&r.onload.length>0){for(e=0;e<r.onload.length;e++)typeof r.onload[e]=="function"&&r.onload[e](r);r.onload=[]}}function ct(){if(te){var e={name:te};r.check_consent(c.VIEWS)&&X({key:g.VIEW,dur:pe?U()-Se:Ie,segmentation:e}),te=null}}function ci(){return te}function Pt(){if(ue){var e=k("cly_session");(!e||parseInt(e)<=U())&&(w=!1,r.begin_session(!Re)),S("cly_session",U()+be*60)}}function dt(e){e.app_key=r.app_key,e.device_id=r.device_id,e.sdk_name=L,e.sdk_version=x,e.t=V,r.check_consent(c.LOCATION)?(r.country_code&&(e.country_code=r.country_code),r.city&&(e.city=r.city),r.ip_address!==null&&(e.ip_address=r.ip_address)):e.location="",e.timestamp=Qe();var n=new Date;e.hour=n.getHours(),e.dow=n.getDay()}function W(e){if(r.ignore_visitor){i(t.WARNING,"User is opt_out will ignore the request: "+e);return}if(!r.app_key||!r.device_id){i(t.ERROR,"app_key or device_id is missing ",r.app_key,r.device_id);return}dt(e),T.length>Z&&T.shift(),T.push(e),S("cly_queue",T,!0)}function Me(){if(Ut(),r.ignore_visitor){Ve=!1,i(t.WARNING,"User opt_out, no heartbeat");return}Ve=!0;var e=0;if(E&&typeof a.q<"u"&&a.q.length>0){var n,s=a.q;for(a.q=[],e=0;e<s.length;e++)if(n=s[e],i(t.DEBUG,"Processing queued call",n),typeof n=="function")n();else if(Array.isArray(n)&&n.length>0){var f=r,p=0;if(a.i[n[p]]&&(f=a.i[n[p]],p++),typeof f[n[p]]=="function")f[n[p]].apply(f,n.slice(p+1));else if(n[p].indexOf("userData.")===0){var l=n[p].replace("userData.","");typeof f.userData[l]=="function"&&f.userData[l].apply(f,n.slice(p+1))}else typeof a[n[p]]=="function"&&a[n[p]].apply(a,n.slice(p+1))}}if(w&&Re&&pe){var u=U();u-fe>Pe&&(r.session_duration(u-fe),fe=u)}if(z.length>0){if(z.length<=ke)W({events:JSON.stringify(z)}),z=[];else{var d=z.splice(0,ke);W({events:JSON.stringify(d)})}S("cly_event",z)}if(!G&&T.length>0&&ze&&U()>rt){ze=!1;var _=T[0];i(t.DEBUG,"Processing request",_),S("cly_queue",T,!0),r.test_mode||le("send_request_queue",r.url+P,_,function(m,R){i(t.DEBUG,"Request Finished",R,m),m?(rt=U()+Ue,i(t.ERROR,"Request error: ",m)):T.shift(),S("cly_queue",T,!0),ze=!0},!1)}setTimeout(Me,Y)}function lt(){var e=k("cly_id");return e?(V=k("cly_id_type"),e):St()}function di(e){return/[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-4[0-9a-fA-F]{3}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}/.test(e)}function Fe(){var e=JSON.parse(JSON.stringify(r.metrics||{}));if(e._app_version=e._app_version||r.app_version,e._ua=e._ua||we(),screen.width){var n=screen.width?parseInt(screen.width):0,s=screen.height?parseInt(screen.height):0;if(n!==0&&s!==0){var f=!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform);if(f&&window.devicePixelRatio)n=Math.round(n*window.devicePixelRatio),s=Math.round(s*window.devicePixelRatio);else if(Math.abs(window.orientation)===90){var p=n;n=s,s=p}e._resolution=e._resolution||""+n+"x"+s}}window.devicePixelRatio&&(e._density=e._density||window.devicePixelRatio);var l=navigator.language||navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage;if(typeof l<"u"&&(e._locale=e._locale||l),typeof document.referrer<"u"&&document.referrer.length){var u=C.exec(document.referrer);if(u&&u[11]&&u[11]!==window.location.hostname){var d=!1;if(ee&&ee.length)for(var _=0;_<ee.length;_++)try{var m=new RegExp(ee[_]);if(m.test(document.referrer)){i(t.DEBUG,"Ignored: "+document.referrer),d=!0;break}}catch(R){i(t.ERROR,"Problem with ignoring: "+ee[_],", error: "+R)}d||(e._store=e._store||document.referrer)}}return i(t.DEBUG,"Got metrics",e),e}function i(e,n){if(r.debug&&typeof console<"u"){arguments[2]&&typeof arguments[2]=="object"&&(arguments[2]=JSON.stringify(arguments[2])),E||(n="["+r.app_key+"] "+n),e||(e=t.DEBUG);for(var s="",f=2;f<arguments.length;f++)s+=arguments[f];var p=e+n+s;e===t.ERROR?console.error(p):e===t.WARNING?console.warn(p):e===t.INFO?console.info(p):e===t.VERBOSE?console.log(p):console.debug(p)}}function le(e,n,s,f,p){p=p||!1;try{i(t.DEBUG,"Sending XML HTTP request");var l=null;window.XMLHttpRequest?l=new window.XMLHttpRequest:window.ActiveXObject&&(l=new window.ActiveXObject("Microsoft.XMLHTTP")),s=s||{};var u=It(s),d="GET";(r.force_post||u.length>=2e3)&&(d="POST"),d==="GET"?l.open("GET",n+"?"+u,!0):(l.open("POST",n,!0),l.setRequestHeader("Content-type","application/x-www-form-urlencoded"));for(var _ in r.headers)l.setRequestHeader(_,r.headers[_]);l.onreadystatechange=function(){if(this.readyState===4){i(t.DEBUG,e+" HTTP request completed ["+this.status+"]["+this.responseText+"]");var m;p?m=Vt(this.status,this.responseText):m=zt(this.status,this.responseText),m?typeof f=="function"&&f(!1,s,this.responseText):(i(t.ERROR,e+" Failed Server XML HTTP request, ",this.status),typeof f=="function"&&f(!0,s))}},d==="GET"?l.send():l.send(u)}catch(m){i(t.ERROR,e+" Failed XML HTTP request: "+m),typeof f=="function"&&f(!0,s)}}function zt(e,n){if(!(e>=200&&e<300))return i(t.ERROR,"Http response status code is not within the expected range:["+e+"]"),!1;try{var s=JSON.parse(n);return Object.prototype.toString.call(s)!=="[object Object]"?(i(t.ERROR,"Http response is not JSON Object"),!1):!!s.result}catch(f){return i(t.ERROR,"Http response is not JSON: "+f),!1}}function Vt(e,n){if(!(e>=200&&e<300))return i(t.ERROR,"Http response status code is not within the expected range: "+e),!1;try{var s=JSON.parse(n);return Object.prototype.toString.call(s)!=="[object Object]"&&!Array.isArray(s)?(i(t.ERROR,"Http response is not JSON Object nor JSON Array"),!1):!0}catch(f){return i(t.ERROR,"Http response is not JSON: "+f),!1}}function Gt(){Ae=Math.max(Ae,window.scrollY,document.body.scrollTop,document.documentElement.scrollTop)}function ft(){if(xe){xe=!1;var e=Ce(),n=tt(),s=kt();if(r.check_consent(c.SCROLLS)){var f={type:"scroll",y:Ae+s,width:n,height:e,view:r.getViewUrl()};f=ae(f,r.maxKeyLength,r.maxValueSize,r.maxSegmentationValues,"processScrollView",i),r.track_domains&&(f.domain=window.location.hostname),X({key:g.ACTION,segmentation:f})}}}function li(){return V}function Mt(e){S("cly_token",e)}function fi(){var e=k("cly_token");return ne("cly_token"),e}function ui(){return z}function pi(){return T}function _i(e){for(var n=e+"=",s=document.cookie.split(";"),f=0,p=s.length;f<p;f++){for(var l=s[f];l.charAt(0)===" ";)l=l.substring(1,l.length);if(l.indexOf(n)===0)return l.substring(n.length,l.length)}return null}function Ft(e,n,s){var f=new Date;f.setTime(f.getTime()+s*24*60*60*1e3);var p="; expires="+f.toGMTString();document.cookie=e+"="+n+p+"; path=/"}function k(e,n,s){if(r.storage==="none"){i(t.WARNING,"Storage is disabled. Value with key: "+e+" won't be retrieved");return}s||(e=r.app_key+"/"+e,r.namespace&&(e=ge(r.namespace)+"/"+e)),n===void 0&&(n=_e);var f;return n?f=localStorage.getItem(e):r.storage!=="localstorage"&&(f=_i(e)),r.deserialize(f)}function S(e,n,s,f){if(r.storage==="none"){i(t.WARNING,"Storage is disabled. Value with key: "+e+" won't be stored");return}f||(e=r.app_key+"/"+e,r.namespace&&(e=ge(r.namespace)+"/"+e)),s===void 0&&(s=_e),typeof n<"u"&&n!==null&&(n=r.serialize(n),s?localStorage.setItem(e,n):r.storage!=="localstorage"&&Ft(e,n,30))}function ne(e,n,s){if(r.storage==="none"){i(t.WARNING,"Storage is disabled. Value with key: "+e+" won't be removed");return}s||(e=r.app_key+"/"+e,r.namespace&&(e=ge(r.namespace)+"/"+e)),n===void 0&&(n=_e),n?localStorage.removeItem(e):r.storage!=="localstorage"&&Ft(e,"",-1)}function mi(){if(k(r.namespace+"cly_id",!1,!0)){S("cly_id",k(r.namespace+"cly_id",!1,!0)),S("cly_id_type",k(r.namespace+"cly_id_type",!1,!0)),S("cly_event",k(r.namespace+"cly_event",!1,!0)),S("cly_session",k(r.namespace+"cly_session",!1,!0));var e=k(r.namespace+"cly_queue",!1,!0);Array.isArray(e)&&(e=e.filter(function(n){return n.app_key===r.app_key}),S("cly_queue",e)),k(r.namespace+"cly_cmp_id",!1,!0)&&(S("cly_cmp_id",k(r.namespace+"cly_cmp_id",!1,!0)),S("cly_cmp_uid",k(r.namespace+"cly_cmp_uid",!1,!0))),k(r.namespace+"cly_ignore",!1,!0)&&S("cly_ignore",k(r.namespace+"cly_ignore",!1,!0)),ne("cly_id",!1,!0),ne("cly_id_type",!1,!0),ne("cly_event",!1,!0),ne("cly_session",!1,!0),ne("cly_queue",!1,!0),ne("cly_cmp_id",!1,!0),ne("cly_cmp_uid",!1,!0),ne("cly_ignore",!1,!0)}}this.onStorageChange=function(e,n){switch(i(t.INFO,"onStorageChange, Applying storage changes"),e){case"cly_queue":T=r.deserialize(n||"[]");break;case"cly_event":z=r.deserialize(n||"[]");break;case"cly_remote_configs":M=r.deserialize(n||"{}");break;case"cly_ignore":r.ignore_visitor=r.deserialize(n);break;case"cly_id":r.device_id=r.deserialize(n);break;case"cly_id_type":V=r.deserialize(n);break;default:}},this._internals={store:S,getDocWidth:tt,getDocHeight:Ce,getViewportHeight:kt,get_page_coord:et,get_event_target:Le,add_event:N,createNewObjectFromProperties:Ee,truncateObject:ae,truncateSingleValue:O,stripTrailingSlash:ge,prepareParams:It,sendXmlHttpRequest:le,isResponseValid:zt,getInternalDeviceIdType:li,getMsTimestamp:Qe,getTimestamp:U,isResponseValidBroad:Vt,log:i,getMetrics:Fe,generateUUID:St,sendEventsForced:ot,isUUID:di,getId:lt,heartBeat:Me,toRequestQueue:W,reportViewDuration:ct,loadJS:xt,loadCSS:Be,getLastView:ci,setToken:Mt,getToken:fi,showLoader:At,hideLoader:Tt,setValueInStorage:S,getValueFromStorage:k,removeValueFromStorage:ne,add_cly_events:X,processScrollView:ft,processScroll:Gt,currentUserAgentString:we,userAgentDeviceDetection:Ot,userAgentSearchBotDetection:Nt,getRequestQueue:pi,getEventQueue:ui,clearQueue:function(){T=[],S("cly_queue",[]),z=[],S("cly_event",[])}},this.initialize()};a.CountlyClass=J,a.init=function(o){o=o||{};var r=o.app_key||a.app_key;if(!a.i||!a.i[r]){var E=new a.CountlyClass(o);if(!a.i){a.i={};for(var w in E)a[w]=E[w]}a.i[r]=E}return a.i[r]};function Rt(o){var r=[];if(typeof o.options<"u")for(var E=0;E<o.options.length;E++)o.options[E].selected&&r.push(o.options[E].value);return r.join(", ")}function St(){var o=new Date().getTime(),r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(E){var w=(o+Math.random()*16)%16|0;return o=Math.floor(o/16),(E==="x"?w:w&3|8).toString(16)});return r}function U(){return Math.floor(new Date().getTime()/1e3)}var De=0;function Qe(){var o=new Date().getTime();return De>=o?De++:De=o,De}function v(o,r,E){if(r&&Object.keys(r).length){if(typeof r[o]<"u")return r[o]}else if(typeof a[o]<"u")return a[o];return E}function Ze(o,r,E){for(var w in a.i)a.i[w].tracking_crashes&&a.i[w].recordError(o,r,E)}function It(o){var r=[];for(var E in o)r.push(E+"="+encodeURIComponent(o[E]));return r.join("&")}function ge(o){return typeof o=="string"&&o.substring(o.length-1)==="/"?o.substring(0,o.length-1):o}function Ee(o,r){for(var E={},w,P=0,K=r.length;P<K;P++)w=r[P],typeof o[w]<"u"&&(E[w]=o[w]);return E}function ai(o,r,E){if(!!E){for(var w,P=0,K=E.length;P<K;P++)w=E[P],typeof r[w]<"u"&&(o[w]=r[w]);return o}}function ae(o,r,E,w,P,K){var Y={};if(o){if(Object.keys(o).length>w){var Z={},T=0;for(var z in o)T<w&&(Z[z]=o[z],T++);o=Z}for(var M in o){var oe=O(M,r,P,K),se=O(o[M],E,P,K);Y[oe]=se}}return Y}function O(o,r,E,w){var P=o;return typeof o=="number"&&(o=o.toString()),typeof o=="string"&&o.length>r&&(P=o.substring(0,r),w(t.DEBUG,E+", Key: [ "+o+" ] is longer than accepted length. It will be truncated.")),P}var oi=function(o,r){for(r=r.toUpperCase();o;){if(o.nodeName.toUpperCase()===r)return o;o=o.parentElement}},N=function(o,r,E){typeof o.addEventListener<"u"?o.addEventListener(r,E,!1):o.attachEvent("on"+r,E)},Le=function(o){return o?typeof o.target<"u"?o.target:o.srcElement:window.event.srcElement};function we(o){if(o)return o;var r=navigator.userAgent;return r||navigator.userAgentData&&(r=navigator.userAgentData.brands.map(function(E){return E.brand+":"+E.version}).join(),r+=navigator.userAgentData.mobile?" mobi ":" ",r+=navigator.userAgentData.platform),r}function Ot(o){var r;if(o)r=o;else{if(navigator.userAgentData.mobile)return"phone";r=we()}r=r.toLowerCase();var E="desktop",w=/(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/,P=/(mobi|ipod|phone|blackberry|opera mini|fennec|minimo|symbian|psp|nintendo ds|archos|skyfire|puffin|blazer|bolt|gobrowser|iris|maemo|semc|teashark|uzard)/;return w.test(r)?E="tablet":P.test(r)&&(E="phone"),E}function Nt(o){var r=/(CountlySiteBot|nuhk|Googlebot|GoogleSecurityScanner|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver|bingbot|Google Web Preview|Mediapartners-Google|AdsBot-Google|Baiduspider|Ezooms|YahooSeeker|AltaVista|AVSearch|Mercator|Scooter|InfoSeek|Ultraseek|Lycos|Wget|YandexBot|Yandex|YaDirectFetcher|SiteBot|Exabot|AhrefsBot|MJ12bot|TurnitinBot|magpie-crawler|Nutch Crawler|CMS Crawler|rogerbot|Domnutch|ssearch_bot|XoviBot|netseer|digincore|fr-crawler|wesee|AliasIO|contxbot|PingdomBot|BingPreview|HeadlessChrome)/;return r.test(o||we())}function et(o){return typeof o.pageY>"u"&&typeof o.clientX=="number"&&document.documentElement&&(o.pageX=o.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,o.pageY=o.clientY+document.body.scrollTop+document.documentElement.scrollTop),o}function Ce(){var o=document;return Math.max(Math.max(o.body.scrollHeight,o.documentElement.scrollHeight),Math.max(o.body.offsetHeight,o.documentElement.offsetHeight),Math.max(o.body.clientHeight,o.documentElement.clientHeight))}function tt(){var o=document;return Math.max(Math.max(o.body.scrollWidth,o.documentElement.scrollWidth),Math.max(o.body.offsetWidth,o.documentElement.offsetWidth),Math.max(o.body.clientWidth,o.documentElement.clientWidth))}function kt(){var o=document;return Math.min(Math.min(o.body.clientHeight,o.documentElement.clientHeight),Math.min(o.body.offsetHeight,o.documentElement.offsetHeight),window.innerHeight)}function si(){return window.innerWidth>window.innerHeight?"landscape":"portrait"}window.addEventListener("storage",function(o){var r=(o.key+"").split("/"),E=r.pop(),w=r.pop();a.i&&a.i[w]&&a.i[w].onStorageChange(E,o.newValue)});function bt(o,r,E,w,P,K){var Y=document.createElement(o),Z;Y.setAttribute(r,E),Y.setAttribute(w,P);var T=function(){Z||K(),Z=!0};K&&(Y.onreadystatechange=T,Y.onload=T),document.getElementsByTagName("head")[0].appendChild(Y)}function xt(o,r){bt("script","type","text/javascript","src",o,r)}function Be(o,r){bt("link","rel","stylesheet","href",o,r)}function At(){var o=document.getElementById("cly-loader");if(!o){var r="#cly-loader {height: 4px; width: 100%; position: absolute; z-index: 99999; overflow: hidden; background-color: #fff; top:0px; left:0px;}#cly-loader:before{display: block; position: absolute; content: ''; left: -200px; width: 200px; height: 4px; background-color: #2EB52B; animation: cly-loading 2s linear infinite;}@keyframes cly-loading { from {left: -200px; width: 30%;} 50% {width: 30%;} 70% {width: 70%;} 80% { left: 50%;} 95% {left: 120%;} to {left: 100%;}}",E=document.head||document.getElementsByTagName("head")[0],w=document.createElement("style");w.type="text/css",w.styleSheet?w.styleSheet.cssText=r:w.appendChild(document.createTextNode(r)),E.appendChild(w),o=document.createElement("div"),o.setAttribute("id","cly-loader"),document.body.onload=function(){if(!a.showLoaderProtection)try{document.body.appendChild(o)}catch{}}}o.style.display="block"}function Tt(){a.showLoaderProtection=!0;var o=document.getElementById("cly-loader");o&&(o.style.display="none")}return a.serialize=function(o){return typeof o=="object"&&(o=JSON.stringify(o)),o},a.deserialize=function(o){try{o=JSON.parse(o)}catch{}return o},a.getViewName=function(){return window.location.pathname},a.getViewUrl=function(){return window.location.pathname},a.getSearchQuery=function(){return window.location.search},a.DeviceIdType={DEVELOPER_SUPPLIED:h.DEVELOPER_SUPPLIED,SDK_GENERATED:h.SDK_GENERATED,TEMPORARY_ID:h.TEMPORARY_ID},a})});var Ji={};Ri(Ji,{ConsentBanner:()=>yt,ConsentToggle:()=>vt,InitCountlyMetrics:()=>Fi,Warning:()=>Et,acceptMetricsConsent:()=>Wi,declineMetricsConsent:()=>Hi,getMetricsConsent:()=>Ki,updateMetricsConsent:()=>wt});var Q=Ke(qe());var Vi=({showConsentBanner:a,consentText:c,showConsentInfoIssueLink:g,onAccept:t,onDecline:h,children:y})=>{let x=c||"We're collecting web-vitals, pageview and other metrics in order to improve and prioritize our work on IPFS";return y?Q.default.createElement(Q.default.Fragment,null,y):a?Q.default.createElement("div",{className:"js-metrics-notification metrics-notification-wrapper"},Q.default.createElement("div",{className:"metrics-notification-container"},Q.default.createElement("div",{className:"metrics-notification-text"},x,g&&Q.default.createElement("div",{className:"metric-info-link-wrapper"},Q.default.createElement("a",{className:"consent-info-link",href:"https://github.com/ipfs/ipfs-gui/issues/125",target:"_blank",rel:"noreferrer"},"See details on metric collection"))),Q.default.createElement("div",{className:"metrics-notification-buttons"},Q.default.createElement("button",{id:"metrics-notification-accept",className:"js-metrics-notification-accept",onClick:t},"\u2611\xA0Agree"),Q.default.createElement("button",{id:"metrics-notification-decline",className:"js-metrics-notification-decline",onClick:h},"Decline")))):null},yt=Vi;var Xe=Ke(qe());var Gi=({onToggleClick:a})=>Xe.default.createElement("button",{onClick:a,className:"cookieConsentToggle js-cookie-banner-toggle","aria-label":"Edit cookie settings"},Xe.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},Xe.default.createElement("path",{d:`M510.52 255.82c-69.97-.85-126.47-57.69-126.47-127.86-70.17
            0-127-56.49-127.86-126.45-27.26-4.14-55.13.3-79.72 12.82l-69.13
            35.22a132.221 132.221 0 0 0-57.79 57.81l-35.1 68.88a132.645 132.645 0 0
            0-12.82 80.95l12.08 76.27a132.521 132.521 0 0 0 37.16 72.96l54.77
            54.76a132.036 132.036 0 0 0 72.71 37.06l76.71 12.15c27.51 4.36 55.7-.11
            80.53-12.76l69.13-35.21a132.273 132.273 0 0 0
            57.79-57.81l35.1-68.88c12.56-24.64 17.01-52.58 12.91-79.91zM176
            368c-17.67 0-32-14.33-32-32s14.33-32 32-32 32 14.33 32 32-14.33 32-32
            32zm32-160c-17.67 0-32-14.33-32-32s14.33-32 32-32 32 14.33 32 32-14.33
            32-32 32zm160 128c-17.67 0-32-14.33-32-32s14.33-32 32-32 32 14.33 32
            32-14.33 32-32 32z`}))),vt=Gi;var re=Ke(qe());var Mi=({showWarning:a,warningText:c,showMetricInfoLink:g,onClose:t,children:h})=>{let y=()=>re.default.createElement("div",{id:"metrics-warning-decline-warning",className:"metrics-warning-text"},c||"We will limit collection of metrics to only necessary features: 'sessions' and 'views'.",g&&re.default.createElement("div",{className:"metric-info-link-wrapper"},"See",re.default.createElement("a",{className:"metrics-warning-link",href:"https://support.count.ly/hc/en-us/articles/360037441932-Web-analytics-JavaScript-#features-for-consent",target:"_blank",rel:"noreferrer"},"Countly's group_features"),"for more information."));return h?re.default.createElement(re.default.Fragment,null,h):a?re.default.createElement("div",{className:"js-metrics-warning-decline-warning metrics-warning-wrapper"},re.default.createElement("div",{className:"metrics-warning-container"},y(),re.default.createElement("div",{className:"metrics-warning-buttons"},re.default.createElement("button",{id:"metrics-warning-warning-close",className:"js-metrics-warning-warning-close",onClick:t},"\u2715\xA0Close")))):null},Et=Mi;var j=Ke(ri()),Fi=(a="3c2c0819434074fc4d339ddd8e112a1e741ecb72",c="https://countly.ipfs.io")=>{window.Countly=j.default,j.default.init({app_key:a,url:c,require_consent:!0});let g=["sessions","views"],t=["attribution","users","location"],h=["events","crashes","apm"],y=["scrolls","clicks","forms","star-rating","feedback"];j.default.group_features({all:[...g,...t,...h,...y],necessary:g,marketing:t,tracking:y,performance:h}),j.default.track_clicks(),j.default.track_errors(),j.default.track_forms(),j.default.track_links(),j.default.track_pageview(),j.default.track_scrolls(),j.default.track_sessions(),j.default.track_view()},wt=a=>{j.default.add_consent(a),Array.isArray(a)?localStorage.setItem("metrics_consent",JSON.stringify(a)):localStorage.setItem("metrics_consent",JSON.stringify([a]))},Wi=()=>{wt(["all"])},Hi=()=>{wt(["necessary"])},Ki=()=>localStorage.getItem("metrics_consent");return Si(Ji);})();
return IgniteMetrics}));
