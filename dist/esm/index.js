import e from"react";function t(e,t){void 0===t&&(t={});var i=t.insertAt;if(e&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css","top"===i&&n.firstChild?n.insertBefore(a,n.firstChild):n.appendChild(a),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(document.createTextNode(e))}}t("\ndiv.metrics-notification-wrapper {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: 100%;\n    height:  auto;\n    position: fixed;\n    top: 0;\n    left: 0;\n  }\n  \n  div.metrics-notification-container {\n    background-color: rgba(246, 248, 251, 1);\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    width: 100%;\n    padding: 15px 15px;\n    max-width: 1024px;\n  }\n\n  div.metrics-notification-link {\n    margin: 0 5px;\n  }\n  \n  .hidden {\n    display: none;\n  }\n  \n  div.metrics-notification-wrapper .metrics-notification-text {\n    color: rgba(7, 58, 83, 1);\n    order: 1;\n    align-self: flex-start;\n    display: flex;\n    flex-direction: column;\n  }\n\n  .metrics-notification-wrapper .metrics-notification-text .metric-info-link-wrapper {\n    padding: 8px 0;\n  }\n  \n  div.metrics-notification-wrapper .metrics-notification-buttons {\n    order: 3;\n    align-self: center;\n    align-items: center;\n    align-content: center;\n    display: flex;\n    gap: 1rem;\n  }\n  \n  div.metrics-notification-wrapper a {\n    color: rgba(107, 196, 206, 1);\n  }\n  \n  div.metrics-notification-wrapper button {\n    border: none;\n    color: rgba(107, 196, 206, 1);\n    cursor: pointer;\n    background-color: transparent;\n    align-content: center;\n    vertical-align: center;\n    text-align: center;\n  }\n  \n  .metrics-notification-wrapper button#metrics-notification-accept {\n    border: 1pt solid rgba(107, 196, 206, 1);\n  }\n  \n  \n  @media (max-width: 1002px) {\n  \n      .metrics-notification-wrapper .metrics-notification-text {\n        color: rgba(7, 58, 83, 1);\n        order: 1;\n        align-self: flex-start;\n        padding: 0 2rem;\n      }\n  \n    .metrics-notification-container {\n      display: flex;\n      flex-direction: column;\n    }\n\n    div.metrics-notification-wrapper .metrics-notification-buttons {\n      margin-top: 8px;\n    }\n  }\n  ");const i=({showConsentBanner:t,consentText:i,showConsentInfoIssueLink:n,onAccept:a,onDecline:r,children:o})=>{const s=i||"We're collecting web-vitals, pageview and other metrics in order to improve and prioritize our work on IPFS";return o?e.createElement("div",{className:"metrics-notification-wrapper"},o):t?e.createElement("div",{className:"js-metrics-notification metrics-notification-wrapper"},e.createElement("div",{className:"metrics-notification-container"},e.createElement("div",{className:"metrics-notification-text"},s,n&&e.createElement("div",{className:"metric-info-link-wrapper"},e.createElement("a",{className:"consent-info-link",href:"https://github.com/ipfs/ipfs-gui/issues/125",target:"_blank",rel:"noreferrer"},"See details on metric collection"))),e.createElement("div",{className:"metrics-notification-buttons"},e.createElement("button",{id:"metrics-notification-accept",className:"js-metrics-notification-accept",onClick:a},"☑ Agree"),e.createElement("button",{id:"metrics-notification-decline",className:"js-metrics-notification-decline",onClick:r},"Decline")))):null};t(".cookieConsentToggle {\n    width: 40px;\n    height: 40px;\n    will-change: transform;\n    padding: 9px;\n    border: 0;\n    box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);\n    background: white;\n    border-radius: 50%;\n    transition: 200ms;\n    opacity: 1;\n    z-index: 99980;\n    cursor: pointer;\n    margin: 0 1em 0 0;\n  }\n  \n  .cookieConsentToggle:disabled {\n    cursor: default;\n  }\n  \n  .cookieConsentToggle:hover:not(:disabled) {\n    color: white;\n    background: #69c4cd;\n  }\n  \n  .cookieConsentToggle * {\n    fill: currentColor;\n  }");const n=({onToggleClick:t})=>e.createElement("button",{onClick:t,className:"cookieConsentToggle js-cookie-banner-toggle","aria-label":"Edit cookie settings"},e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},e.createElement("path",{d:"M510.52 255.82c-69.97-.85-126.47-57.69-126.47-127.86-70.17\n            0-127-56.49-127.86-126.45-27.26-4.14-55.13.3-79.72 12.82l-69.13\n            35.22a132.221 132.221 0 0 0-57.79 57.81l-35.1 68.88a132.645 132.645 0 0\n            0-12.82 80.95l12.08 76.27a132.521 132.521 0 0 0 37.16 72.96l54.77\n            54.76a132.036 132.036 0 0 0 72.71 37.06l76.71 12.15c27.51 4.36 55.7-.11\n            80.53-12.76l69.13-35.21a132.273 132.273 0 0 0\n            57.79-57.81l35.1-68.88c12.56-24.64 17.01-52.58 12.91-79.91zM176\n            368c-17.67 0-32-14.33-32-32s14.33-32 32-32 32 14.33 32 32-14.33 32-32\n            32zm32-160c-17.67 0-32-14.33-32-32s14.33-32 32-32 32 14.33 32 32-14.33\n            32-32 32zm160 128c-17.67 0-32-14.33-32-32s14.33-32 32-32 32 14.33 32\n            32-14.33 32-32 32z"})));t("\n.metrics-warning-wrapper {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: 100%;\n    height:  auto;\n    position: fixed;\n    top: 0;\n    left: 0;\n  }\n  \n  .metrics-warning-container {\n    background-color: rgba(246, 248, 251, 1);\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    width: 100%;\n    padding: 15px 15px;\n    max-width: 1024px;\n  }\n  \n  .hidden {\n    display: none;\n  }\n  \n  div.metrics-warning-wrapper .metrics-warning-text {\n    color: rgba(7, 58, 83, 1);\n    order: 1;\n    align-self: flex-start;\n    display: flex;\n    flex-direction: column;\n  }\n\n  div.metrics-warning-wrapper .metrics-warning-text .metric-info-link-wrapper {\n    padding: 8px 0 0;\n  }\n  \n  div.metrics-warning-wrapper .metrics-warning-buttons {\n    order: 3;\n    align-items: flex-start;\n    justify-content: flex-start;\n    display: flex;\n    gap: 1rem;\n    height: 100%;\n    flex-direction: column;\n    margin-left: 8px;\n  }\n  \n  div.metrics-warning-wrapper a {\n    color: rgba(107, 196, 206, 1);\n  }\n  \n  div.metrics-warning-wrapper button {\n    border: none;\n    color: rgba(107, 196, 206, 1);\n    cursor: pointer;\n    background-color: transparent;\n    align-content: center;\n    vertical-align: center;\n    text-align: center;\n  }\n  \n  .metrics-warning-wrapper button#metrics-warning-accept {\n    border: 1pt solid rgba(107, 196, 206, 1);\n  }\n\n  .metrics-warning-wrapper .metrics-warning-link {\n    margin: 0 5px;\n  }\n  \n  \n  button#metrics-warning-close {\n    border: 1pt solid rgba(107, 196, 206, 1);\n    /* color: rgba(7, 58, 83, 1); */\n  }\n  \n  @media (max-width: 1002px) {\n  \n      .metrics-warning-wrapper .metrics-warning-text {\n        color: rgba(7, 58, 83, 1);\n        order: 1;\n        align-self: flex-start;\n        display: flex;\n        flex-direction: column;\n      }\n\n      div.metrics-warning-wrapper .metrics-warning-text .metric-info-link-wrapper {\n        padding: 8px 0;\n      }\n  \n    /* .metrics-warning-container {\n      display: flex;\n      flex-direction: column;\n    } */\n\n    /* div.metrics-notification-wrapper .metrics-warning-buttons {\n        margin-top: 8px;\n      } */\n  }\n  ");const a=({showWarning:t,warningText:i,showMetricInfoLink:n,onClose:a,children:r})=>r?e.createElement("div",{className:"js-metrics-warning-decline-warning metrics-warning-wrapper"},r):t?e.createElement("div",{className:"js-metrics-warning-decline-warning metrics-warning-wrapper"},e.createElement("div",{className:"metrics-warning-container"},(()=>{const t=i||"We will limit collection of metrics to only necessary features: 'sessions' and 'views'.";return e.createElement("div",{id:"metrics-warning-decline-warning",className:"metrics-warning-text"},t,n&&e.createElement("div",{className:"metric-info-link-wrapper"},"See",e.createElement("a",{className:"metrics-warning-link",href:"https://support.count.ly/hc/en-us/articles/360037441932-Web-analytics-JavaScript-#features-for-consent",target:"_blank",rel:"noreferrer"},"Countly's group_features"),"for more information."))})(),e.createElement("div",{className:"metrics-warning-buttons"},e.createElement("button",{id:"metrics-warning-warning-close",className:"js-metrics-warning-warning-close",onClick:a},"✕ Close")))):null;var r,o,s,c="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},d={exports:{}};r=d,o="undefined"!=typeof window?window:c,s=function(e){if("undefined"!=typeof window){var t="sessions",i="events",n="views",a="scrolls",r="clicks",o="forms",s="crashes",c="attribution",d="users",l="star-rating",u="location",g="apm",p="feedback",m="remote-config";(e=e||{}).features=[t,i,n,a,r,o,s,c,d,l,u,g,p,m];var h="[CLY]_nps",f="[CLY]_survey",_="[CLY]_star_rating",y="[CLY]_view",v="[CLY]_orientation",w="[CLY]_push_action",b="[CLY]_action",k="[ERROR] ",x="[WARNING] ",S="[INFO] ",C="[DEBUG] ",E="[VERBOSE] ",z=0,L=1,I=2,D=3,T=500,N=1e3,O=60,A=20,W=60,R=100,V=30,B=128,P=256,M=30,q=100,j=30,F=200;e.q=e.q||[],e.onload=e.onload||[];var J="22.06.4",H="javascript_native_web",U=/^(((([^:\/#\?]+:)?(?:(\/\/)((?:(([^:@\/#\?]+)(?:\:([^:@\/#\?]+))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?:\:([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/;e.CountlyClass=function(Y){var he,we=this,be=!e.i,ke=!1,xe="/i",Se="/o/sdk",Ce=te("interval",Y,T),Ee=te("queue_size",Y,N),ze=[],Le=[],Ie={},De=[],Te={},Ne=te("ignore_referrers",Y,[]),Oe=null,Ae=!0,We=0,Re=null,Ve=0,Be=0,Pe=0,Me=te("fail_timeout",Y,O),qe=te("inactivity_time",Y,A),je=0,Fe=te("session_update",Y,W),Je=te("max_events",Y,R),He=te("max_logs",Y,null),Ue=te("use_session_cookie",Y,!0),Ye=te("session_cookie_timeout",Y,V),Ke=!0,Ge=!1,Xe=te("offline_mode",Y,!1),$e={},Qe=!0,Ze=Z(),et=!0,tt=null,it=L,nt=!1,at=0;try{localStorage.setItem("cly_testLocal",!0),localStorage.removeItem("cly_testLocal")}catch(e){St(k,"Local storage test failed, Halting local storage support: "+e),et=!1}for(var rt,ot={},st=0;st<e.features.length;st++)ot[e.features[st]]={};this.initialize=function(){if(this.serialize=te("serialize",Y,e.serialize),this.deserialize=te("deserialize",Y,e.deserialize),this.getViewName=te("getViewName",Y,e.getViewName),this.getViewUrl=te("getViewUrl",Y,e.getViewUrl),this.getSearchQuery=te("getSearchQuery",Y,e.getSearchQuery),this.DeviceIdType=e.DeviceIdType,this.namespace=te("namespace",Y,""),this.clearStoredId=te("clear_stored_id",Y,!1),this.app_key=te("app_key",Y,null),this.onload=te("onload",Y,[]),this.utm=te("utm",Y,{source:!0,medium:!0,campaign:!0,term:!0,content:!0}),this.ignore_prefetch=te("ignore_prefetch",Y,!0),this.rcAutoOptinAb=te("rc_automatic_optin_for_ab",Y,!0),this.useExplicitRcApi=te("use_explicit_rc_api",Y,!1),this.debug=te("debug",Y,!1),this.test_mode=te("test_mode",Y,!1),this.metrics=te("metrics",Y,{}),this.headers=te("headers",Y,{}),this.url=ae(te("url",Y,"")),this.app_version=te("app_version",Y,"0.0"),this.country_code=te("country_code",Y,null),this.city=te("city",Y,null),this.ip_address=te("ip_address",Y,null),this.ignore_bots=te("ignore_bots",Y,!0),this.force_post=te("force_post",Y,!1),this.remote_config=te("remote_config",Y,!1),this.ignore_visitor=te("ignore_visitor",Y,!1),this.require_consent=te("require_consent",Y,!1),this.track_domains=te("track_domains",Y,!0),this.storage=te("storage",Y,"default"),this.enableOrientationTracking=te("enable_orientation_tracking",Y,!0),this.maxKeyLength=te("max_key_length",Y,B),this.maxValueSize=te("max_value_size",Y,P),this.maxSegmentationValues=te("max_segmentation_values",Y,M),this.maxBreadcrumbCount=te("max_breadcrumb_count",Y,null),this.maxStackTraceLinesPerThread=te("max_stack_trace_lines_per_thread",Y,j),this.maxStackTraceLineLength=te("max_stack_trace_line_length",Y,F),this.heatmapWhitelist=te("heatmap_whitelist",Y,[]),He&&!this.maxBreadcrumbCount?(this.maxBreadcrumbCount=He,St(x,"initialize, 'maxCrashLogs' is deprecated. Use 'maxBreadcrumbCount' instead!")):He||this.maxBreadcrumbCount||(this.maxBreadcrumbCount=100),"cookie"===this.storage&&(et=!1),this.rcAutoOptinAb||this.useExplicitRcApi||(St(x,"initialize, Auto opting is disabled, switching to explicit RC API"),this.useExplicitRcApi=!0),Array.isArray(Ne)||(Ne=[]),""===this.url&&(St(k,"initialize, Please provide server URL"),this.ignore_visitor=!0),Nt("cly_ignore")&&(this.ignore_visitor=!0),function(){if(Nt(we.namespace+"cly_id",!1,!0)){Ot("cly_id",Nt(we.namespace+"cly_id",!1,!0)),Ot("cly_id_type",Nt(we.namespace+"cly_id_type",!1,!0)),Ot("cly_event",Nt(we.namespace+"cly_event",!1,!0)),Ot("cly_session",Nt(we.namespace+"cly_session",!1,!0));var e=Nt(we.namespace+"cly_queue",!1,!0);Array.isArray(e)&&Ot("cly_queue",e=e.filter((function(e){return e.app_key===we.app_key}))),Nt(we.namespace+"cly_cmp_id",!1,!0)&&(Ot("cly_cmp_id",Nt(we.namespace+"cly_cmp_id",!1,!0)),Ot("cly_cmp_uid",Nt(we.namespace+"cly_cmp_uid",!1,!0))),Nt(we.namespace+"cly_ignore",!1,!0)&&Ot("cly_ignore",Nt(we.namespace+"cly_ignore",!1,!0)),At("cly_id",!1,!0),At("cly_id_type",!1,!0),At("cly_event",!1,!0),At("cly_session",!1,!0),At("cly_queue",!1,!0),At("cly_cmp_id",!1,!0),At("cly_cmp_uid",!1,!0),At("cly_ignore",!1,!0)}}(),this.clearStoredId&&(St(S,"initialize, Clearing the device ID storage"),localStorage.removeItem(this.app_key+"/cly_id"),localStorage.removeItem(this.app_key+"/cly_id_type")),ze=Nt("cly_queue")||[],Le=Nt("cly_event")||[],Ie=Nt("cly_remote_configs")||{},pt(),window.name&&0===window.name.indexOf("cly:"))try{this.passed_data=JSON.parse(window.name.replace("cly:",""))}catch(e){St(k,"initialize, Could not parse name: "+window.name+", error: "+e)}else if(location.hash&&0===location.hash.indexOf("#cly:"))try{this.passed_data=JSON.parse(location.hash.replace("#cly:",""))}catch(e){St(k,"initialize, Could not parse hash: "+location.hash+", error: "+e)}if((this.passed_data&&this.passed_data.app_key&&this.passed_data.app_key===this.app_key||this.passed_data&&!this.passed_data.app_key&&be)&&this.passed_data.token&&this.passed_data.purpose){this.passed_data.token!==Nt("cly_old_token")&&(Dt(this.passed_data.token),Ot("cly_old_token",this.passed_data.token));var t=[];Array.isArray(this.heatmapWhitelist)?(this.heatmapWhitelist.push(this.url),t=this.heatmapWhitelist.map((function(e){return ae(e)}))):t=[this.url],t.includes(this.passed_data.url)&&"heatmap"===this.passed_data.purpose&&(this.ignore_visitor=!0,ye(),fe(this.passed_data.url+"/views/heatmap.js",ve))}if(this.ignore_visitor)St(x,"initialize, ignore_visitor:["+this.ignore_visitor+"], this user will not be tracked");else{St(C,"initialize, app_key:["+this.app_key+"], url:["+this.url+"]"),St(C,"initialize, device_id:["+te("device_id",Y,void 0)+"]"),St(C,"initialize, require_consent is enabled:["+this.require_consent+"]");try{St(C,"initialize, metric override:["+JSON.stringify(this.metrics)+"]"),St(C,"initialize, header override:["+JSON.stringify(this.headers)+"]"),St(C,"initialize, number of onload callbacks provided:["+this.onload.length+"]"),St(C,"initialize, utm tags:["+JSON.stringify(this.utm)+"]"),Ne&&St(C,"initialize, referrers to ignore :["+JSON.stringify(Ne)+"]")}catch(e){St(k,"initialize, Could not stringify some config object values")}St(C,"initialize, app_version:["+this.app_version+"]"),St(C,"initialize, provided location info; country_code:["+this.country_code+"], city:["+this.city+"], ip_address:["+this.ip_address+"]"),""!==this.namespace&&St(C,"initialize, namespace given:["+this.namespace+"]"),this.clearStoredId&&St(C,"initialize, clearStoredId flag set to:["+this.clearStoredId+"]"),this.ignore_prefetch&&St(C,"initialize, ignoring pre-fetching and pre-rendering from counting as real website visits :["+this.ignore_prefetch+"]"),this.test_mode&&St(x,"initialize, test_mode:["+this.test_mode+"], queues won't be processed"),this.heatmapWhitelist&&St(C,"initialize, heatmap whitelist:["+JSON.stringify(this.heatmapWhitelist)+"], these domains will be whitelisted"),"default"!==this.storage&&St(C,"initialize, storage is set to:["+this.storage+"]"),this.ignore_bots&&St(C,"initialize, ignore traffic from bots :["+this.ignore_bots+"]"),this.force_post&&St(C,"initialize, forced post method for all requests:["+this.force_post+"]"),this.remote_config&&St(C,"initialize, remote_config callback provided:["+!!this.remote_config+"]"),"boolean"==typeof this.rcAutoOptinAb&&St(C,"initialize, automatic RC optin is enabled:["+this.rcAutoOptinAb+"]"),this.useExplicitRcApi||St(x,"initialize, will use legacy RC API. Consider enabling new API during init with use_explicit_rc_api flag"),this.track_domains&&St(C,"initialize, tracking domain info:["+this.track_domains+"]"),this.enableOrientationTracking&&St(C,"initialize, enableOrientationTracking:["+this.enableOrientationTracking+"]"),Ue||St(x,"initialize, use_session_cookie is enabled:["+Ue+"]"),Xe&&St(C,"initialize, offline_mode:["+Xe+"], user info won't be send to the servers"),Xe&&St(C,"initialize, stored remote configs:["+JSON.stringify(Ie)+"]"),St(C,"initialize, 'getViewName' callback override provided:["+!!this.getViewName+"]"),St(C,"initialize, 'getSearchQuery' callback override provided:["+!!this.getSearchQuery+"]"),this.maxKeyLength!==B&&St(C,"initialize, maxKeyLength set to:["+this.maxKeyLength+"] characters"),this.maxValueSize!==P&&St(C,"initialize, maxValueSize set to:["+this.maxValueSize+"] characters"),this.maxSegmentationValues!==M&&St(C,"initialize, maxSegmentationValues set to:["+this.maxSegmentationValues+"] key/value pairs"),this.maxBreadcrumbCount!==q&&St(C,"initialize, maxBreadcrumbCount for custom logs set to:["+this.maxBreadcrumbCount+"] entries"),this.maxStackTraceLinesPerThread!==j&&St(C,"initialize, maxStackTraceLinesPerThread set to:["+this.maxStackTraceLinesPerThread+"] lines"),this.maxStackTraceLineLength!==F&&St(C,"initialize, maxStackTraceLineLength set to:["+this.maxStackTraceLineLength+"] characters"),Ce!==T&&St(C,"initialize, interval for heartbeats set to:["+Ce+"] milliseconds"),Ee!==N&&St(C,"initialize, queue_size set to:["+Ee+"] items max"),Me!==O&&St(C,"initialize, fail_timeout set to:["+Me+"] seconds of wait time after a failed connection to server"),qe!==A&&St(C,"initialize, inactivity_time set to:["+qe+"] minutes to consider a user as inactive after no observable action"),Fe!==W&&St(C,"initialize, session_update set to:["+Fe+"] seconds to check if extending a session is needed while the user is active"),Je!==R&&St(C,"initialize, max_events set to:["+Je+"] events to send in one batch"),He&&St(x,"initialize, max_logs set to:["+He+"] breadcrumbs to store for crash logs max, deprecated "),Ye!==V&&St(C,"initialize, session_cookie_timeout set to:["+Ye+"] minutes to expire a cookies session"),St(S,"initialize, Countly initialized");var i=null,n=we.getSearchQuery(),a=!1,r={};if(n)for(var o=n.substring(1).split("&"),s=0;s<o.length;s++){var c=o[s].split("=");"cly_id"===c[0]?Ot("cly_cmp_id",c[1]):"cly_uid"===c[0]?Ot("cly_cmp_uid",c[1]):"cly_device_id"===c[0]?i=c[1]:0===(c[0]+"").indexOf("utm_")&&this.utm[c[0].replace("utm_","")]&&(r[c[0].replace("utm_","")]=c[1],a=!0)}var d="[CLY]_temp_id"===Nt("cly_id"),l=te("device_id",Y,void 0);if(Nt("cly_id")&&!d?(this.device_id=Nt("cly_id"),St(S,"initialize, Set the stored device ID"),(it=Nt("cly_id_type"))||(St(S,"initialize, No device ID type info from the previous session, falling back to DEVELOPER_SUPPLIED"),it=z)):null!==i?(St(S,"initialize, Device ID set by URL"),this.device_id=i,it=D):l?(St(S,"initialize, Device ID set by developer"),this.device_id=l,Y&&Object.keys(Y).length?void 0!==Y.device_id&&(it=z):void 0!==e.device_id&&(it=z)):Xe||d?(this.device_id="[CLY]_temp_id",it=I,Xe&&d?St(S,"initialize, Temp ID set, continuing offline mode from previous app session"):Xe&&!d?St(S,"initialize, Temp ID set, entering offline mode"):(Xe=!0,St(S,"initialize, Temp ID set, enabling offline mode"))):(St(S,"initialize, Generating the device ID"),this.device_id=te("device_id",Y,kt()),Y&&Object.keys(Y).length?void 0!==Y.device_id&&(it=z):void 0!==e.device_id&&(it=z)),Ot("cly_id",this.device_id),Ot("cly_id_type",it),a){for(var u in this.utm)r[u]?this.userData.set("utm_"+u,r[u]):this.userData.unset("utm_"+u);this.userData.save()}ft(),setTimeout((function(){bt(),we.remote_config&&we.fetch_remote_config(we.remote_config)}),1),document.documentElement.setAttribute("data-countly-useragent",ce())}},this.halt=function(){St(x,"halt, Resetting Countly"),e.i=void 0,be=!e.i,ke=!1,xe="/i",Se="/o/sdk",Ce=500,Ee=1e3,ze=[],Le=[],Ie={},De=[],Te={},Ne=[],Oe=null,Ae=!0,We=0,Re=null,Ve=0,Be=0,Pe=0,Me=60,qe=20,je=0,Fe=60,Je=100,He=null,Ue=!0,Ye=30,Ke=!0,Ge=!1,Xe=!1,$e={},Qe=!0,Ze=Z(),et=!0,tt=null,it=L,nt=!1,at=0;try{localStorage.setItem("cly_testLocal",!0),localStorage.removeItem("cly_testLocal")}catch(e){St(k,"halt, Local storage test failed, will fallback to cookies"),et=!1}e.features=[t,i,n,a,r,o,s,c,d,l,u,g,p,m],ot={};for(var h=0;h<e.features.length;h++)ot[e.features[h]]={};we.app_key=void 0,we.device_id=void 0,we.onload=void 0,we.utm=void 0,we.ignore_prefetch=void 0,we.debug=void 0,we.test_mode=void 0,we.metrics=void 0,we.headers=void 0,we.url=void 0,we.app_version=void 0,we.country_code=void 0,we.city=void 0,we.ip_address=void 0,we.ignore_bots=void 0,we.force_post=void 0,we.rcAutoOptinAb=void 0,we.useExplicitRcApi=void 0,we.remote_config=void 0,we.ignore_visitor=void 0,we.require_consent=void 0,we.track_domains=void 0,we.storage=void 0,we.enableOrientationTracking=void 0,we.maxKeyLength=void 0,we.maxValueSize=void 0,we.maxSegmentationValues=void 0,we.maxBreadcrumbCount=void 0,we.maxStackTraceLinesPerThread=void 0,we.maxStackTraceLineLength=void 0},this.group_features=function(e){if(St(S,"group_features, Grouping features"),e)for(var t in e)ot[t]?St(x,"group_features, Feature name ["+t+"] is already reserved"):"string"==typeof e[t]?ot[t]={features:[e[t]]}:e[t]&&Array.isArray(e[t])&&e[t].length?ot[t]={features:e[t]}:St(k,"group_features, Incorrect feature list for ["+t+"] value: ["+e[t]+"]");else St(k,"group_features, Incorrect features:["+e+"]")},this.check_consent=function(e){return St(S,"check_consent, Checking if consent is given for specific feature:["+e+"]"),this.require_consent?ot[e]?!(!ot[e]||!ot[e].optin):(St(k,"check_consent, No feature available for ["+e+"]"),!1):(St(S,"check_consent, require_consent is off, no consent is necessary"),!0)},this.get_device_id_type=function(){var e;switch(St(S,"check_device_id_type, Retrieving the current device id type.["+it+"]"),it){case L:e=we.DeviceIdType.SDK_GENERATED;break;case D:case z:e=we.DeviceIdType.DEVELOPER_SUPPLIED;break;case I:e=we.DeviceIdType.TEMPORARY_ID;break;default:e=-1}return e},this.get_device_id=function(){return St(S,"get_device_id, Retrieving the device id: ["+this.device_id+"]"),this.device_id},this.check_any_consent=function(){if(St(S,"check_any_consent, Checking if any consent is given"),!this.require_consent)return St(S,"check_any_consent, require_consent is off, no consent is necessary"),!0;for(var e in ot)if(ot[e]&&ot[e].optin)return!0;return St(S,"check_any_consent, No consents given"),!1},this.add_consent=function(e){if(St(S,"add_consent, Adding consent for ["+e+"]"),Array.isArray(e))for(var i=0;i<e.length;i++)this.add_consent(e[i]);else ot[e]?ot[e].features?(ot[e].optin=!0,this.add_consent(ot[e].features)):!0!==ot[e].optin&&(ot[e].optin=!0,ct(),setTimeout((function(){e===t&&$e.begin_session?(we.begin_session.apply(we,$e.begin_session),$e.begin_session=null):e===n&&$e.track_pageview&&(Re=null,we.track_pageview.apply(we,$e.track_pageview),$e.track_pageview=null)}),1)):St(k,"add_consent, No feature available for ["+e+"]")},this.remove_consent=function(e){St(S,"remove_consent, Removing consent for ["+e+"]"),this.remove_consent_internal(e,!0)},this.remove_consent_internal=function(e,t){if(t=t||!1,Array.isArray(e))for(var i=0;i<e.length;i++)this.remove_consent_internal(e[i],t);else ot[e]?ot[e].features?this.remove_consent_internal(ot[e].features,t):(ot[e].optin=!1,t&&!1!==ot[e].optin&&ct()):St(k,"remove_consent, No feature available for ["+e+"]")};var ct=function(){rt&&(clearTimeout(rt),rt=null),rt=setTimeout((function(){for(var t={},i=0;i<e.features.length;i++)!0===ot[e.features[i]].optin?t[e.features[i]]=!0:t[e.features[i]]=!1;wt({consent:JSON.stringify(t)}),St(C,"Consent update request has been sent to the queue.")}),1e3)};function dt(e){if(we.ignore_visitor)St(k,"Adding event failed. Possible bot or user opt out");else if(e.key){e.count||(e.count=1),e.key=se(e.key,we.maxKeyLength,"add_cly_event",St),e.segmentation=oe(e.segmentation,we.maxKeyLength,we.maxValueSize,we.maxSegmentationValues,"add_cly_event",St);var t=re(e,["key","count","sum","dur","segmentation"]);t.timestamp=ee();var i=new Date;t.hour=i.getHours(),t.dow=i.getDay(),Le.push(t),Ot("cly_event",Le),St(S,"Successfully adding event: ",e)}else St(k,"Adding event failed. Event must have a key property")}this.enable_offline_mode=function(){St(S,"enable_offline_mode, Enabling offline mode"),this.remove_consent_internal(e.features,!1),Xe=!0,this.device_id="[CLY]_temp_id",it=I},this.disable_offline_mode=function(e){St(S,"disable_offline_mode, Disabling offline mode"),Xe=!1,e&&this.device_id!==e?(this.device_id=e,it=z,Ot("cly_id",this.device_id),Ot("cly_id_type",z),St(S,"disable_offline_mode, Changing id to: "+this.device_id)):(this.device_id=kt(),this.device_id!==Nt("cly_id")&&(Ot("cly_id",this.device_id),Ot("cly_id_type",L)));var t=!1;if(ze.length>0)for(var i=0;i<ze.length;i++)"[CLY]_temp_id"===ze[i].device_id&&(ze[i].device_id=this.device_id,t=!0);t&&Ot("cly_queue",ze,!0)},this.begin_session=function(e,i){if(St(S,"begin_session, Starting the session"),e&&St(S,"begin_session, Heartbeats are disabled"),i&&St(S,"begin_session, Session starts irrespective of session cookie"),this.check_consent(t)){if(!ke){this.enableOrientationTracking&&(this.report_orientation(),G(window,"resize",(function(){we.report_orientation()}))),he=Z(),ke=!0,Ae=!e;var n=Nt("cly_session");if(i||!Ue||!n||parseInt(n)<=Z()){St(S,"begin_session, Session started"),null===tt&&(tt=!0);var a={begin_session:1};a.metrics=JSON.stringify(xt()),wt(a)}Ot("cly_session",Z()+60*Ye)}}else $e.begin_session=arguments},this.session_duration=function(e){St(S,"session_duration, Reporting session duration"),this.check_consent(t)&&ke&&(St(S,"session_duration, Session extended: ",e),wt({session_duration:e}),yt())},this.end_session=function(e,i){St(S,"end_session, Ending the current session"),this.check_consent(t)&&ke&&(e=e||Z()-he,_t(),!Ue||i?(St(S,"end_session, Session ended"),wt({end_session:1,session_duration:e})):this.session_duration(e),ke=!1)},this.change_id=function(t,i){if(St(S,"change_id, Changing the ID"),i&&St(S,"change_id, Will merge the IDs"),t&&"string"==typeof t&&0!==t.length){if(Xe)return St(x,"change_id, Offline mode was on, initiating disabling sequence instead."),void this.disable_offline_mode(t);if(this.device_id!==t){i||(mt(),this.end_session(null,!0),Te={},this.remove_consent_internal(e.features,!1));var n=this.device_id;this.device_id=t,it=z,Ot("cly_id",this.device_id),Ot("cly_id_type",z),St(S,"change_id, Changing ID from:["+n+"] to ["+t+"]"),i?wt({old_device_id:n}):this.begin_session(!Ae,!0),this.remote_config&&(Ot("cly_remote_configs",Ie={}),this.fetch_remote_config(this.remote_config))}}else St(k,"change_id, The provided ID: ["+t+"] is not a valid ID")},this.add_event=function(e){St(S,"add_event, Adding event: ",e);var t=!1;switch(e.key){case h:case f:t=this.check_consent("feedback");break;case _:t=this.check_consent("star-rating");break;case y:t=this.check_consent("views");break;case v:t=this.check_consent("users");break;case w:t=this.check_consent("push");break;case b:t=this.check_consent("clicks")||this.check_consent("scroll");break;default:t=this.check_consent("events")}t&&dt(e)},this.start_event=function(e){St(S,"start_event, Starting timed event with key: ["+e+"]"),e=se(e,we.maxKeyLength,"start_event",St),Te[e]?St(x,"start_event, Timed event with key ["+e+"] already started"):Te[e]=Z()},this.end_event=function(e){St(S,"end_event, Ending timed event"),"string"==typeof e&&(e={key:e}),e.key?Te[e.key]?(e.dur=Z()-Te[e.key],this.add_event(e),delete Te[e.key]):St(k,"end_event, Timed event with key ["+e.key+"] was not started"):St(k,"end_event, Timed event must have a key property")},this.report_orientation=function(e){St(S,"report_orientation, Reporting orientation"),this.check_consent(d)&&dt({key:v,segmentation:{mode:e||(window.innerWidth>window.innerHeight?"landscape":"portrait")}})},this.report_conversion=function(e,t){St(x,"report_conversion, Deprecated function call! Use 'recordDirectAttribution' in place of this call. Call will be redirected now!"),this.recordDirectAttribution(e,t)},this.recordDirectAttribution=function(e,t){St(S,"recordDirectAttribution, Recording the attribution for campaign ID: ["+e+"] and the user ID: ["+t+"]"),this.check_consent(c)&&(e=e||Nt("cly_cmp_id")||"cly_organic",wt((t=t||Nt("cly_cmp_uid"))?{campaign_id:e,campaign_user:t}:{campaign_id:e}))},this.user_details=function(e){St(S,"user_details, Trying to add user details: ",e),this.check_consent(d)&&(e.name=se(e.name,we.maxValueSize,"user_details",St),e.username=se(e.username,we.maxValueSize,"user_details",St),e.email=se(e.email,we.maxValueSize,"user_details",St),e.organization=se(e.organization,we.maxValueSize,"user_details",St),e.phone=se(e.phone,we.maxValueSize,"user_details",St),e.picture=se(e.picture,4096,"user_details",St),e.gender=se(e.gender,we.maxValueSize,"user_details",St),e.byear=se(e.byear,we.maxValueSize,"user_details",St),e.custom=oe(e.custom,we.maxKeyLength,we.maxValueSize,we.maxSegmentationValues,"user_details",St),wt({user_details:JSON.stringify(re(e,["name","username","email","organization","phone","picture","gender","byear","custom"]))}))};var lt={},ut=function(e,t,i){we.check_consent(d)&&(lt[e]||(lt[e]={}),"$push"===i||"$pull"===i||"$addToSet"===i?(lt[e][i]||(lt[e][i]=[]),lt[e][i].push(t)):lt[e][i]=t)};function gt(e,i,n,a,r){St(S,"fetch_remote_config_explicit, Fetching sequence initiated");var o,s={method:"rc"};e&&(s.keys=JSON.stringify(e)),i&&(s.omit_keys=JSON.stringify(i)),"legacy"===a&&(s.method="fetch_remote_config"),0===n&&(s.oi=0),1===n&&(s.oi=1),"function"==typeof r&&(o=r),we.check_consent(t)&&(s.metrics=JSON.stringify(xt())),we.check_consent(m)?(vt(s),Ct("fetch_remote_config_explicit",we.url+Se,s,(function(e,t,i){if(e)St(k,"fetch_remote_config_explicit, An error occurred: "+e);else{try{var n=JSON.parse(i);if(s.keys||s.omit_keys)for(var a in n)Ie[a]=n[a];else Ie=n;Ot("cly_remote_configs",Ie)}catch(e){St(k,"fetch_remote_config_explicit, Had an issue while parsing the response: "+e)}o&&(St(S,"fetch_remote_config_explicit, Callback function is provided"),o(e,Ie))}}),!0)):(St(k,"fetch_remote_config_explicit, Remote config requires explicit consent"),o&&o(new Error("Remote config requires explicit consent"),Ie))}function pt(){we.ignore_prefetch&&void 0!==document.visibilityState&&"prerender"===document.visibilityState&&(we.ignore_visitor=!0),we.ignore_bots&&le()&&(we.ignore_visitor=!0)}function mt(){Le.length>0&&(wt({events:JSON.stringify(Le)}),Ot("cly_event",Le=[]))}function ht(e,t){if(document.getElementById("countly-feedback-sticker-"+e._id))St(k,"Widget with same ID exists");else try{var i=document.createElement("div");i.className="countly-iframe-wrapper",i.id="countly-iframe-wrapper-"+e._id;var n=document.createElement("span");n.className="countly-feedback-close-icon",n.id="countly-feedback-close-icon-"+e._id,n.innerText="x";var a=document.createElement("iframe");if(a.name="countly-feedback-iframe",a.id="countly-feedback-iframe",a.src=we.url+"/feedback?widget_id="+e._id+"&app_key="+we.app_key+"&device_id="+we.device_id+"&sdk_version="+J,document.body.appendChild(i),i.appendChild(n),i.appendChild(a),G(document.getElementById("countly-feedback-close-icon-"+e._id),"click",(function(){document.getElementById("countly-iframe-wrapper-"+e._id).style.display="none",document.getElementById("cfbg").style.display="none"})),t){var r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.id="feedback-sticker-svg",r.setAttribute("aria-hidden","true"),r.setAttribute("data-prefix","far"),r.setAttribute("data-icon","grin"),r.setAttribute("class","svg-inline--fa fa-grin fa-w-16"),r.setAttribute("role","img"),r.setAttribute("xmlns","http://www.w3.org/2000/svg"),r.setAttribute("viewBox","0 0 496 512");var o=document.createElementNS("http://www.w3.org/2000/svg","path");o.id="smileyPathInStickerSvg",o.setAttribute("fill","white"),o.setAttribute("d","M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-110.3 0-200-89.7-200-200S137.7 56 248 56s200 89.7 200 200-89.7 200-200 200zm105.6-151.4c-25.9 8.3-64.4 13.1-105.6 13.1s-79.6-4.8-105.6-13.1c-9.9-3.1-19.4 5.4-17.7 15.3 7.9 47.1 71.3 80 123.3 80s115.3-32.9 123.3-80c1.6-9.8-7.7-18.4-17.7-15.3zM168 240c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm160 0c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32z");var s=document.createElement("span");s.innerText=e.trigger_button_text;var c=document.createElement("div");c.style.color=e.trigger_font_color.length<7?"#"+e.trigger_font_color:e.trigger_font_color,c.style.backgroundColor=e.trigger_bg_color.length<7?"#"+e.trigger_bg_color:e.trigger_bg_color,c.className="countly-feedback-sticker  "+e.trigger_position+"-"+e.trigger_size,c.id="countly-feedback-sticker-"+e._id,r.appendChild(o),c.appendChild(r),c.appendChild(s),document.body.appendChild(c);var d=document.getElementById("smileyPathInStickerSvg");d&&(d.style.fill=e.trigger_font_color.length<7?"#"+e.trigger_font_color:e.trigger_font_color),G(document.getElementById("countly-feedback-sticker-"+e._id),"click",(function(){document.getElementById("countly-iframe-wrapper-"+e._id).style.display="block",document.getElementById("cfbg").style.display="block"}))}else document.getElementById("countly-iframe-wrapper-"+e._id).style.display="block",document.getElementById("cfbg").style.display="block"}catch(e){St(k,"Somethings went wrong while element injecting process: "+e)}}function ft(){var e;if(void 0!==we.onload&&we.onload.length>0){for(e=0;e<we.onload.length;e++)"function"==typeof we.onload[e]&&we.onload[e](we);we.onload=[]}}function _t(){if(Re){var e={name:Re};we.check_consent(n)&&dt({key:y,dur:Qe?Z()-Ve:Be,segmentation:e}),Re=null}}function yt(){if(Ue){var e=Nt("cly_session");(!e||parseInt(e)<=Z())&&(ke=!1,we.begin_session(!Ae)),Ot("cly_session",Z()+60*Ye)}}function vt(e){e.app_key=we.app_key,e.device_id=we.device_id,e.sdk_name=H,e.sdk_version=J,e.t=it,we.check_consent(u)?(we.country_code&&(e.country_code=we.country_code),we.city&&(e.city=we.city),null!==we.ip_address&&(e.ip_address=we.ip_address)):e.location="",e.timestamp=ee();var t=new Date;e.hour=t.getHours(),e.dow=t.getDay()}function wt(e){we.ignore_visitor?St(x,"User is opt_out will ignore the request: "+e):we.app_key&&we.device_id?(vt(e),ze.length>Ee&&ze.shift(),ze.push(e),Ot("cly_queue",ze,!0)):St(k,"app_key or device_id is missing ",we.app_key,we.device_id)}function bt(){if(ft(),we.ignore_visitor)return Ge=!1,void St(x,"User opt_out, no heartbeat");Ge=!0;var t=0;if(be&&void 0!==e.q&&e.q.length>0){var i,n=e.q;for(e.q=[],t=0;t<n.length;t++)if(i=n[t],St(C,"Processing queued call",i),"function"==typeof i)i();else if(Array.isArray(i)&&i.length>0){var a=we,r=0;if(e.i[i[r]]&&(a=e.i[i[r]],r++),"function"==typeof a[i[r]])a[i[r]].apply(a,i.slice(r+1));else if(0===i[r].indexOf("userData.")){var o=i[r].replace("userData.","");"function"==typeof a.userData[o]&&a.userData[o].apply(a,i.slice(r+1))}else"function"==typeof e[i[r]]&&e[i[r]].apply(e,i.slice(r+1))}}if(ke&&Ae&&Qe){var s=Z();s-he>Fe&&(we.session_duration(s-he),he=s)}if(Le.length>0){if(Le.length<=Je)wt({events:JSON.stringify(Le)}),Le=[];else{var c=Le.splice(0,Je);wt({events:JSON.stringify(c)})}Ot("cly_event",Le)}if(!Xe&&ze.length>0&&Ke&&Z()>Pe){Ke=!1;var d=ze[0];St(C,"Processing request",d),Ot("cly_queue",ze,!0),we.test_mode||Ct("send_request_queue",we.url+xe,d,(function(e,t){St(C,"Request Finished",t,e),e?(Pe=Z()+Me,St(k,"Request error: ",e)):ze.shift(),Ot("cly_queue",ze,!0),Ke=!0}),!1)}setTimeout(bt,Ce)}function kt(){var e=Nt("cly_id");return e?(it=Nt("cly_id_type"),e):Q()}function xt(){var e=JSON.parse(JSON.stringify(we.metrics||{}));if(e._app_version=e._app_version||we.app_version,e._ua=e._ua||ce(),screen.width){var t=screen.width?parseInt(screen.width):0,i=screen.height?parseInt(screen.height):0;if(0!==t&&0!==i){if(navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform)&&window.devicePixelRatio)t=Math.round(t*window.devicePixelRatio),i=Math.round(i*window.devicePixelRatio);else if(90===Math.abs(window.orientation)){var n=t;t=i,i=n}e._resolution=e._resolution||t+"x"+i}}window.devicePixelRatio&&(e._density=e._density||window.devicePixelRatio);var a=navigator.language||navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage;if(void 0!==a&&(e._locale=e._locale||a),void 0!==document.referrer&&document.referrer.length){var r=U.exec(document.referrer);if(r&&r[11]&&r[11]!==window.location.hostname){var o=!1;if(Ne&&Ne.length)for(var s=0;s<Ne.length;s++)try{if(new RegExp(Ne[s]).test(document.referrer)){St(C,"Ignored: "+document.referrer),o=!0;break}}catch(e){St(k,"Problem with ignoring: "+Ne[s],", error: "+e)}o||(e._store=e._store||document.referrer)}}return St(C,"Got metrics",e),e}function St(e,t){if(we.debug&&"undefined"!=typeof console){arguments[2]&&"object"==typeof arguments[2]&&(arguments[2]=JSON.stringify(arguments[2])),be||(t="["+we.app_key+"] "+t),e||(e=C);for(var i="",n=2;n<arguments.length;n++)i+=arguments[n];var a=e+t+i;e===k?console.error(a):e===x?console.warn(a):e===S?console.info(a):e===E?console.log(a):console.debug(a)}}function Ct(e,t,i,n,a){a=a||!1;try{St(C,"Sending XML HTTP request");var r=null;window.XMLHttpRequest?r=new window.XMLHttpRequest:window.ActiveXObject&&(r=new window.ActiveXObject("Microsoft.XMLHTTP"));var o=ne(i=i||{}),s="GET";for(var c in(we.force_post||o.length>=2e3)&&(s="POST"),"GET"===s?r.open("GET",t+"?"+o,!0):(r.open("POST",t,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded")),we.headers)r.setRequestHeader(c,we.headers[c]);r.onreadystatechange=function(){4===this.readyState&&(St(C,e+" HTTP request completed ["+this.status+"]["+this.responseText+"]"),(a?zt(this.status,this.responseText):Et(this.status,this.responseText))?"function"==typeof n&&n(!1,i,this.responseText):(St(k,e+" Failed Server XML HTTP request, ",this.status),"function"==typeof n&&n(!0,i)))},"GET"===s?r.send():r.send(o)}catch(t){St(k,e+" Failed XML HTTP request: "+t),"function"==typeof n&&n(!0,i)}}function Et(e,t){if(!(e>=200&&e<300))return St(k,"Http response status code is not within the expected range:["+e+"]"),!1;try{var i=JSON.parse(t);return"[object Object]"!==Object.prototype.toString.call(i)?(St(k,"Http response is not JSON Object"),!1):!!i.result}catch(e){return St(k,"Http response is not JSON: "+e),!1}}function zt(e,t){if(!(e>=200&&e<300))return St(k,"Http response status code is not within the expected range: "+e),!1;try{var i=JSON.parse(t);return!("[object Object]"!==Object.prototype.toString.call(i)&&!Array.isArray(i)&&(St(k,"Http response is not JSON Object nor JSON Array"),1))}catch(e){return St(k,"Http response is not JSON: "+e),!1}}function Lt(){at=Math.max(at,window.scrollY,document.body.scrollTop,document.documentElement.scrollTop)}function It(){if(nt){nt=!1;var e=ge(),t=pe(),i=me();if(we.check_consent(a)){var n={type:"scroll",y:at+i,width:t,height:e,view:we.getViewUrl()};n=oe(n,we.maxKeyLength,we.maxValueSize,we.maxSegmentationValues,"processScrollView",St),we.track_domains&&(n.domain=window.location.hostname),dt({key:b,segmentation:n})}}}function Dt(e){Ot("cly_token",e)}function Tt(e,t,i){var n=new Date;n.setTime(n.getTime()+24*i*60*60*1e3);var a="; expires="+n.toGMTString();document.cookie=e+"="+t+a+"; path=/"}function Nt(e,t,i){var n;if("none"!==we.storage)return i||(e=we.app_key+"/"+e,we.namespace&&(e=ae(we.namespace)+"/"+e)),void 0===t&&(t=et),t?n=localStorage.getItem(e):"localstorage"!==we.storage&&(n=function(e){for(var t=e+"=",i=document.cookie.split(";"),n=0,a=i.length;n<a;n++){for(var r=i[n];" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(t))return r.substring(t.length,r.length)}return null}(e)),we.deserialize(n);St(x,"Storage is disabled. Value with key: "+e+" won't be retrieved")}function Ot(e,t,i,n){"none"!==we.storage?(n||(e=we.app_key+"/"+e,we.namespace&&(e=ae(we.namespace)+"/"+e)),void 0===i&&(i=et),null!=t&&(t=we.serialize(t),i?localStorage.setItem(e,t):"localstorage"!==we.storage&&Tt(e,t,30))):St(x,"Storage is disabled. Value with key: "+e+" won't be stored")}function At(e,t,i){"none"!==we.storage?(i||(e=we.app_key+"/"+e,we.namespace&&(e=ae(we.namespace)+"/"+e)),void 0===t&&(t=et),t?localStorage.removeItem(e):"localstorage"!==we.storage&&Tt(e,"",-1)):St(x,"Storage is disabled. Value with key: "+e+" won't be removed")}this.userData={set:function(e,t){St(S,"set, Setting user's custom property value: ["+t+"] under the key: ["+e+"]"),e=se(e,we.maxKeyLength,"userData set",St),t=se(t,we.maxValueSize,"userData set",St),lt[e]=t},unset:function(e){St(S,"unset, Resetting user's custom property with key: ["+e+"] "),lt[e]=""},set_once:function(e,t){St(S,"set_once, Setting user's unique custom property value: ["+t+"] under the key: ["+e+"] "),e=se(e,we.maxKeyLength,"userData set_once",St),t=se(t,we.maxValueSize,"userData set_once",St),ut(e,t,"$setOnce")},increment:function(e){St(S,"increment, Increasing user's custom property value under the key: ["+e+"] by one"),e=se(e,we.maxKeyLength,"userData increment",St),ut(e,1,"$inc")},increment_by:function(e,t){St(S,"increment_by, Increasing user's custom property value under the key: ["+e+"] by: ["+t+"]"),e=se(e,we.maxKeyLength,"userData increment_by",St),t=se(t,we.maxValueSize,"userData increment_by",St),ut(e,t,"$inc")},multiply:function(e,t){St(S,"multiply, Multiplying user's custom property value under the key: ["+e+"] by: ["+t+"]"),e=se(e,we.maxKeyLength,"userData multiply",St),t=se(t,we.maxValueSize,"userData multiply",St),ut(e,t,"$mul")},max:function(e,t){St(S,"max, Saving user's maximum custom property value compared to the value: ["+t+"] under the key: ["+e+"]"),e=se(e,we.maxKeyLength,"userData max",St),t=se(t,we.maxValueSize,"userData max",St),ut(e,t,"$max")},min:function(e,t){St(S,"min, Saving user's minimum custom property value compared to the value: ["+t+"] under the key: ["+e+"]"),e=se(e,we.maxKeyLength,"userData min",St),t=se(t,we.maxValueSize,"userData min",St),ut(e,t,"$min")},push:function(e,t){St(S,"push, Pushing a value: ["+t+"] under the key: ["+e+"] to user's custom property array"),e=se(e,we.maxKeyLength,"userData push",St),t=se(t,we.maxValueSize,"userData push",St),ut(e,t,"$push")},push_unique:function(e,t){St(S,"push_unique, Pushing a unique value: ["+t+"] under the key: ["+e+"] to user's custom property array"),e=se(e,we.maxKeyLength,"userData push_unique",St),t=se(t,we.maxValueSize,"userData push_unique",St),ut(e,t,"$addToSet")},pull:function(e,t){St(S,"pull, Removing the value: ["+t+"] under the key: ["+e+"] from user's custom property array"),ut(e,t,"$pull")},save:function(){St(S,"save, Saving changes to user's custom property"),we.check_consent(d)&&wt({user_details:JSON.stringify({custom:lt})}),lt={}}},this.report_trace=function(e){if(St(S,"report_trace, Reporting performance trace"),this.check_consent(g)){for(var t=["type","name","stz","etz","apm_metrics","apm_attr"],i=0;i<t.length;i++)if("apm_attr"!==t[i]&&void 0===e[t[i]])return void St(x,"report_trace, APM trace don't have the property: "+t[i]);e.name=se(e.name,we.maxKeyLength,"report_trace",St),e.app_metrics=oe(e.app_metrics,we.maxKeyLength,we.maxValueSize,we.maxSegmentationValues,"report_trace",St);var n=re(e,t);n.timestamp=e.stz;var a=new Date;n.hour=a.getHours(),n.dow=a.getDay(),wt({apm:JSON.stringify(n)}),St(S,"report_trace, Successfully adding APM trace: ",n)}},this.track_errors=function(t){St(S,"track_errors, Started tracking errors"),e.i[this.app_key].tracking_crashes=!0,window.cly_crashes||(window.cly_crashes=!0,Oe=t,window.onerror=function e(t,i,n,a,r){if(null!=r)ie(r,!1);else{var o="";void 0!==t&&(o+=t+"\n"),void 0!==i&&(o+="at "+i),void 0!==n&&(o+=":"+n),void 0!==(a=a||window.event&&window.event.errorCharacter)&&(o+=":"+a),o+="\n";try{for(var s=[],c=e.caller;c;)s.push(c.name),c=c.caller;o+=s.join("\n")}catch(e){St(k,"track_errors, Call stack generation experienced a problem: "+e)}ie(o,!1)}},window.addEventListener("unhandledrejection",(function(e){ie(new Error("Unhandled rejection (reason: "+(e.reason&&e.reason.stack?e.reason.stack:e.reason)+")."),!0)})))},this.log_error=function(e,t){St(S,"log_error, Logging errors"),this.recordError(e,!0,t)},this.add_log=function(e){if(St(S,"add_log, Adding a new log of breadcrumbs: [ "+e+" ]"),this.check_consent(s)){for(e=se(e,we.maxValueSize,"add_log",St);De.length>=we.maxBreadcrumbCount;)De.shift(),St(x,"add_log, Reached maximum crashLogs size. Will erase the oldest one.");De.push(e)}},this.fetch_remote_config=function(e,t,i){var n=null,a=null,r=null;if(e&&(i||"function"!=typeof e?Array.isArray(e)&&(n=e):r=e),t&&(i||"function"!=typeof t?Array.isArray(t)&&(a=t):r=t),r||"function"!=typeof i||(r=i),this.useExplicitRcApi)return St(S,"fetch_remote_config, Fetching remote config"),void gt(n,a,this.rcAutoOptinAb?1:0,null,r);St(x,"fetch_remote_config, Fetching remote config, with legacy API"),gt(n,a,null,"legacy",r)},this.enrollUserToAb=function(e){if(St(S,"enrollUserToAb, Providing AB test keys to opt in for"),e&&Array.isArray(e)&&0!==e.length){var t={method:"ab",keys:JSON.stringify(e)};vt(t),Ct("enrollUserToAb",this.url+Se,t,(function(e,t,i){if(e)St(k,"enrollUserToAb, An error occurred: "+e);else try{var n=JSON.parse(i);St(C,"enrollUserToAb, Parsed the response's result: ["+n.result+"]")}catch(e){St(k,"enrollUserToAb, Had an issue while parsing the response: "+e)}}),!0)}else St(k,"enrollUserToAb, No keys provided")},this.get_remote_config=function(e){return St(S,"get_remote_config, Getting remote config from storage"),void 0!==e?Ie[e]:Ie},this.stop_time=function(){St(S,"stop_time, Stopping tracking duration"),Qe&&(Qe=!1,We=Z()-he,Be=Z()-Ve)},this.start_time=function(){St(S,"start_time, Starting tracking duration"),Qe||(Qe=!0,he=Z()-We,Ve=Z()-Be,Be=0,yt())},this.track_sessions=function(){St(S,"track_session, Starting tracking user session"),this.begin_session(),this.start_time(),G(window,"beforeunload",(function(){mt(),we.end_session()}));var e="hidden";function t(){document[e]||!document.hasFocus()?we.stop_time():we.start_time()}function i(){je>=qe&&we.start_time(),je=0}G(window,"focus",t),G(window,"blur",t),G(window,"pageshow",t),G(window,"pagehide",t),"onfocusin"in document&&(G(window,"focusin",t),G(window,"focusout",t)),e in document?document.addEventListener("visibilitychange",t):"mozHidden"in document?(e="mozHidden",document.addEventListener("mozvisibilitychange",t)):"webkitHidden"in document?(e="webkitHidden",document.addEventListener("webkitvisibilitychange",t)):"msHidden"in document&&(e="msHidden",document.addEventListener("msvisibilitychange",t)),G(window,"mousemove",i),G(window,"click",i),G(window,"keydown",i),G(window,"scroll",i),setInterval((function(){++je>=qe&&we.stop_time()}),6e4)},this.track_pageview=function(e,t,i){if(St(S,"track_pageview, Tracking page views"),St(E,"track_pageview, last view is:["+Re+"]"),Re&&(St(C,"track_pageview, Scroll registry triggered"),It(),nt=!0,at=0),_t(),(e=se(e,we.maxKeyLength,"track_pageview",St))&&Array.isArray(e)&&(t=e,e=null),e||(e=this.getViewName()),void 0!==e&&""!==e)if(null!==e){if(t&&t.length)for(var a=0;a<t.length;a++)try{var r=new RegExp(t[a]);if(r.test(e))return void St(S,"track_pageview, Ignoring the page: "+e)}catch(e){St(k,"track_pageview, Problem with finding ignore list item: "+t[a]+", error: "+e)}Re=e,Ve=Z(),St(E,"track_pageview, last view is assigned:["+Re+"]");var o={name:e,visit:1,view:we.getViewUrl()};if(o=oe(o,we.maxKeyLength,we.maxValueSize,we.maxSegmentationValues,"track_pageview",St),this.track_domains&&(o.domain=window.location.hostname),Ue)if(ke)tt&&(tt=!1,o.start=1);else{var s=Nt("cly_session");(!s||parseInt(s)<=Z())&&(tt=!1,o.start=1)}else if(void 0!==document.referrer&&document.referrer.length){var c=U.exec(document.referrer);c&&c[11]&&c[11]!==window.location.hostname&&(o.start=1)}if(i)for(var d in i=oe(i,we.maxKeyLength,we.maxValueSize,we.maxSegmentationValues,"track_pageview",St))void 0===o[d]&&(o[d]=i[d]);this.check_consent(n)?dt({key:y,segmentation:o}):$e.track_pageview=arguments}else St(k,"track_pageview, View name returned as null. Page view will be ignored.");else St(k,"track_pageview, No page name to track (it is either undefined or empty string). No page view can be tracked.")},this.track_view=function(e,t,i){St(S,"track_view, Initiating tracking page views"),this.track_pageview(e,t,i)},this.track_clicks=function(e){St(S,"track_clicks, Starting to track clicks"),e&&St(S,"track_clicks, Tracking the specified children:["+e+"]"),e=e||document;var t=!0;G(e,"click",(function(e){if(t){if(t=!1,ue(e),void 0!==e.pageX&&void 0!==e.pageY){var i=ge(),n=pe();if(we.check_consent(r)){var a={type:"click",x:e.pageX,y:e.pageY,width:n,height:i,view:we.getViewUrl()};a=oe(a,we.maxKeyLength,we.maxValueSize,we.maxSegmentationValues,"processClick",St),we.track_domains&&(a.domain=window.location.hostname),dt({key:b,segmentation:a})}}setTimeout((function(){t=!0}),1e3)}}))},this.track_scrolls=function(e){St(S,"track_scrolls, Starting to track scrolls"),e&&St(S,"track_scrolls, Tracking the specified children"),e=e||window,nt=!0,G(e,"scroll",Lt),G(e,"beforeunload",It)},this.track_links=function(e){St(S,"track_links, Starting to track clicks to links"),e&&St(S,"track_links, Tracking the specified children"),e=e||document,G(e,"click",(function(e){var t=K(X(e),"a");t&&(ue(e),we.check_consent(r)&&dt({key:"linkClick",segmentation:{href:t.href,text:t.innerText,id:t.id,view:we.getViewUrl()}}))}))},this.track_forms=function(e,t){function i(e){return e.name||e.id||e.type||e.nodeName}St(S,"track_forms, Starting to track form submissions. DOM object provided:["+!!e+"] Tracking hidden inputs :["+!!t+"]"),e=e||document,G(e,"submit",(function(e){var n,a=X(e),r={id:a.attributes.id&&a.attributes.id.nodeValue,name:a.attributes.name&&a.attributes.name.nodeValue,action:a.attributes.action&&a.attributes.action.nodeValue,method:a.attributes.method&&a.attributes.method.nodeValue,view:we.getViewUrl()};if(void 0!==a.elements){for(var s=0;s<a.elements.length;s++)(n=a.elements[s])&&"password"!==n.type&&-1===n.className.indexOf("cly_user_ignore")&&(void 0===r["input:"+i(n)]&&(r["input:"+i(n)]=[]),"select"===n.nodeName.toLowerCase()?void 0!==n.multiple?r["input:"+i(n)].push($(n)):r["input:"+i(n)].push(n.options[n.selectedIndex].value):"input"===n.nodeName.toLowerCase()?void 0!==n.type?"checkbox"===n.type.toLowerCase()||"radio"===n.type.toLowerCase()?n.checked&&r["input:"+i(n)].push(n.value):("hidden"!==n.type.toLowerCase()||t)&&r["input:"+i(n)].push(n.value):r["input:"+i(n)].push(n.value):("textarea"===n.nodeName.toLowerCase()||void 0!==n.value)&&r["input:"+i(n)].push(n.value));for(var c in r)r[c]&&"function"==typeof r[c].join&&(r[c]=r[c].join(", "))}we.check_consent(o)&&dt({key:"formSubmit",segmentation:r})}))},this.collect_from_forms=function(e,t){St(S,"collect_from_forms, Starting to collect possible user data. DOM object provided:["+!!e+"] Submitting custom user property:["+!!t+"]"),e=e||document,G(e,"submit",(function(i){var n,a=X(i),r={},o=!1;if(void 0!==a.elements){var s,c,d={},l=e.getElementsByTagName("LABEL");for(s=0;s<l.length;s++)l[s].htmlFor&&""!==l[s].htmlFor&&(d[l[s].htmlFor]=l[s].innerText||l[s].textContent||l[s].innerHTML);for(s=0;s<a.elements.length;s++)if((n=a.elements[s])&&"password"!==n.type&&-1===n.className.indexOf("cly_user_ignore")){var u="";if("select"===n.nodeName.toLowerCase()?u=void 0!==n.multiple?$(n):n.options[n.selectedIndex].value:"input"===n.nodeName.toLowerCase()?(void 0===n.type||"checkbox"!==n.type.toLowerCase()&&"radio"!==n.type.toLowerCase()||n.checked)&&(u=n.value):("textarea"===n.nodeName.toLowerCase()||void 0!==n.value)&&(u=n.value),n.className&&-1!==n.className.indexOf("cly_user_")){var g=n.className.split(" ");for(c=0;c<g.length;c++)if(0===g[c].indexOf("cly_user_")){r[g[c].replace("cly_user_","")]=u,o=!0;break}}else n.type&&"email"===n.type.toLowerCase()||n.name&&-1!==n.name.toLowerCase().indexOf("email")||n.id&&-1!==n.id.toLowerCase().indexOf("email")||n.id&&d[n.id]&&-1!==d[n.id].toLowerCase().indexOf("email")||/[^@\s]+@[^@\s]+\.[^@\s]+/.test(u)?(r.email||(r.email=u),o=!0):n.name&&-1!==n.name.toLowerCase().indexOf("username")||n.id&&-1!==n.id.toLowerCase().indexOf("username")||n.id&&d[n.id]&&-1!==d[n.id].toLowerCase().indexOf("username")?(r.username||(r.username=u),o=!0):n.name&&(-1!==n.name.toLowerCase().indexOf("tel")||-1!==n.name.toLowerCase().indexOf("phone")||-1!==n.name.toLowerCase().indexOf("number"))||n.id&&(-1!==n.id.toLowerCase().indexOf("tel")||-1!==n.id.toLowerCase().indexOf("phone")||-1!==n.id.toLowerCase().indexOf("number"))||n.id&&d[n.id]&&(-1!==d[n.id].toLowerCase().indexOf("tel")||-1!==d[n.id].toLowerCase().indexOf("phone")||-1!==d[n.id].toLowerCase().indexOf("number"))?(r.phone||(r.phone=u),o=!0):n.name&&(-1!==n.name.toLowerCase().indexOf("org")||-1!==n.name.toLowerCase().indexOf("company"))||n.id&&(-1!==n.id.toLowerCase().indexOf("org")||-1!==n.id.toLowerCase().indexOf("company"))||n.id&&d[n.id]&&(-1!==d[n.id].toLowerCase().indexOf("org")||-1!==d[n.id].toLowerCase().indexOf("company"))?(r.organization||(r.organization=u),o=!0):(n.name&&-1!==n.name.toLowerCase().indexOf("name")||n.id&&-1!==n.id.toLowerCase().indexOf("name")||n.id&&d[n.id]&&-1!==d[n.id].toLowerCase().indexOf("name"))&&(r.name||(r.name=""),r.name+=u+" ",o=!0)}}o&&(St(S,"collect_from_forms, Gathered user data",r),t?we.user_details({custom:r}):we.user_details(r))}))},this.collect_from_facebook=function(e){St(S,"collect_from_facebook, Starting to collect possible user data"),FB&&FB.api&&FB.api("/me",(function(t){var i={};if(t.name&&(i.name=t.name),t.email&&(i.email=t.email),"male"===t.gender?i.gender="M":"female"===t.gender&&(i.gender="F"),t.birthday){var n=t.birthday.split("/").pop();n&&4===n.length&&(i.byear=n)}if(t.work&&t.work[0]&&t.work[0].employer&&t.work[0].employer.name&&(i.organization=t.work[0].employer.name),e)for(var a in i.custom={},e){for(var r=e[a].split("."),o=t,s=0;s<r.length&&void 0!==(o=o[r[s]]);s++);void 0!==o&&(i.custom[a]=o)}we.user_details(i)}))},this.opt_out=function(){St(S,"opt_out, Opting out the user"),this.ignore_visitor=!0,Ot("cly_ignore",!0)},this.opt_in=function(){St(S,"opt_in, Opting in the user"),Ot("cly_ignore",!1),this.ignore_visitor=!1,pt(),this.ignore_visitor||Ge||bt()},this.report_feedback=function(e){St(x,"report_feedback, Deprecated function call! Use 'recordRatingWidgetWithID' or 'reportFeedbackWidgetManually' in place of this call. Call will be redirected to 'recordRatingWidgetWithID' now!"),this.recordRatingWidgetWithID(e)},this.recordRatingWidgetWithID=function(e){if(St(S,"recordRatingWidgetWithID, Providing information about user with ID: [ "+e.widget_id+" ]"),this.check_consent(l))if(e.widget_id)if(e.rating){var t={key:_,count:1,segmentation:{}};t.segmentation=re(e,["widget_id","contactMe","platform","app_version","rating","email","comment"]),t.segmentation.app_version||(t.segmentation.app_version=this.metrics._app_version||this.app_version),t.segmentation.rating>5?(St(x,"recordRatingWidgetWithID, You have entered a rating higher than 5. Changing it back to 5 now."),t.segmentation.rating=5):t.segmentation.rating<1&&(St(x,"recordRatingWidgetWithID, You have entered a rating lower than 1. Changing it back to 1 now."),t.segmentation.rating=1),St(S,"recordRatingWidgetWithID, Reporting Rating Widget: ",t),dt(t)}else St(k,"recordRatingWidgetWithID, Rating Widget must contain rating property");else St(k,"recordRatingWidgetWithID, Rating Widget must contain widget_id property")},this.reportFeedbackWidgetManually=function(e,t,i){if(this.check_consent(p))if(e&&t)if(e._id)if(Xe)St(k,"reportFeedbackWidgetManually, Feedback Widgets can not be reported in offline mode");else{St(S,"reportFeedbackWidgetManually, Providing information about user with, provided result of the widget with  ID: [ "+e._id+" ] and type: ["+e.type+"]");var n,a=[],r=e.type;if("nps"===r){if(i){if(!i.rating)return void St(k,"reportFeedbackWidgetManually, Widget must contain rating property");i.rating=Math.round(i.rating),i.rating>10?(St(x,"reportFeedbackWidgetManually, You have entered a rating higher than 10. Changing it back to 10 now."),i.rating=10):i.rating<0&&(St(x,"reportFeedbackWidgetManually, You have entered a rating lower than 0. Changing it back to 0 now."),i.rating=0),a=["rating","comment"]}n=h}else if("survey"===r){if(i){if(Object.keys(i).length<1)return void St(k,"reportFeedbackWidgetManually, Widget should have answers to be reported");a=Object.keys(i)}n=f}else{if("rating"!==r)return void St(k,"reportFeedbackWidgetManually, Widget has an unacceptable type");if(i){if(!i.rating)return void St(k,"reportFeedbackWidgetManually, Widget must contain rating property");i.rating=Math.round(i.rating),i.rating>5?(St(x,"reportFeedbackWidgetManually, You have entered a rating higher than 5. Changing it back to 5 now."),i.rating=5):i.rating<1&&(St(x,"reportFeedbackWidgetManually, You have entered a rating lower than 1. Changing it back to 1 now."),i.rating=1),a=["rating","comment","email","contactMe"]}n=_}var o={key:n,count:1,segmentation:{widget_id:e._id,platform:this.platform,app_version:this.metrics._app_version||this.app_version}};null===i?o.segmentation.closed=1:o.segmentation=function(e,t,i){if(i){for(var n,a=0,r=i.length;a<r;a++)void 0!==t[n=i[a]]&&(e[n]=t[n]);return e}}(o.segmentation,i,a),St(S,"reportFeedbackWidgetManually, Reporting "+r+": ",o),dt(o)}else St(k,"reportFeedbackWidgetManually, Feedback Widgets must contain _id property");else St(k,"reportFeedbackWidgetManually, Widget data and/or Widget object not provided. Aborting.")},this.show_feedback_popup=function(e){St(x,"show_feedback_popup, Deprecated function call! Use 'presentRatingWidgetWithID' in place of this call. Call will be redirected now!"),this.presentRatingWidgetWithID(e)},this.presentRatingWidgetWithID=function(e){St(S,"presentRatingWidgetWithID, Showing rating widget popup for the widget with ID: [ "+e+" ]"),this.check_consent(l)&&(Xe?St(k,"presentRatingWidgetWithID, Cannot show ratingWidget popup in offline mode"):Ct("presentRatingWidgetWithID",this.url+"/o/feedback/widget",{widget_id:e},(function(e,t,i){if(e)St(k,"presentRatingWidgetWithID, An error occurred: "+e);else try{ht(JSON.parse(i),!1)}catch(e){St(k,"presentRatingWidgetWithID, JSON parse failed: "+e)}}),!0))},this.initialize_feedback_popups=function(e){St(x,"initialize_feedback_popups, Deprecated function call! Use 'initializeRatingWidgets' in place of this call. Call will be redirected now!"),this.initializeRatingWidgets(e)},this.initializeRatingWidgets=function(e){if(St(S,"initializeRatingWidgets, Initializing rating widget with provided widget IDs:[ "+e+"]"),this.check_consent(l)){e||(e=Nt("cly_fb_widgets"));for(var t=document.getElementsByClassName("countly-feedback-sticker");t.length>0;)t[0].remove();Ct("initializeRatingWidgets",this.url+"/o/feedback/multiple-widgets-by-id",{widgets:JSON.stringify(e)},(function(e,t,i){if(e)St(k,"initializeRatingWidgets, An error occurred: "+e);else try{for(var n=JSON.parse(i),a=0;a<n.length;a++)if("true"===n[a].is_active&&n[a].target_devices[de()])if("string"==typeof n[a].hide_sticker&&(n[a].hide_sticker="true"===n[a].hide_sticker),"all"!==n[a].target_page||n[a].hide_sticker)for(var r=n[a].target_pages,o=0;o<r.length;o++){var s=r[o].substr(0,r[o].length-1)===window.location.pathname.substr(0,r[o].length-1),c=r[o]===window.location.pathname;(r[o].includes("*")&&s||c)&&!n[a].hide_sticker&&ht(n[a],!0)}else ht(n[a],!0)}catch(e){St(k,"initializeRatingWidgets, JSON parse error: "+e)}}),!0)}},this.enable_feedback=function(e){St(x,"enable_feedback, Deprecated function call! Use 'enableRatingWidgets' in place of this call. Call will be redirected now!"),this.enableRatingWidgets(e)},this.enableRatingWidgets=function(e){if(St(S,"enableRatingWidgets, Enabling rating widget with params:",e),this.check_consent(l))if(Xe)St(k,"enableRatingWidgets, Cannot enable rating widgets in offline mode");else{Ot("cly_fb_widgets",e.popups||e.widgets),_e(this.url+"/star-rating/stylesheets/countly-feedback-web.css");var t=e.popups||e.widgets;t.length>0?(document.body.insertAdjacentHTML("beforeend",'<div id="cfbg"></div>'),this.initializeRatingWidgets(t)):St(k,"enableRatingWidgets, You should provide at least one widget id as param. Read documentation for more detail. https://resources.count.ly/plugins/feedback")}},this.get_available_feedback_widgets=function(e){St(S,"get_available_feedback_widgets, Getting the feedback list, callback function is provided:["+!!e+"]"),this.check_consent(p)?Xe?St(k,"get_available_feedback_widgets, Cannot enable feedback widgets in offline mode."):Ct("get_available_feedback_widgets",this.url+Se,{method:p,device_id:this.device_id,app_key:this.app_key},(function(t,i,n){if(t)return St(k,"get_available_feedback_widgets, Error occurred while fetching feedbacks: "+t),void(e&&e(null,t));try{var a=JSON.parse(n).result||[];return void(e&&e(a,null))}catch(t){St(k,"get_available_feedback_widgets, Error while parsing feedback widgets list: "+t),e&&e(null,t)}}),!1):e&&e(null,new Error("Consent for feedback not provided."))},this.getFeedbackWidgetData=function(e,t){if(e.type)if(St(S,"getFeedbackWidgetData, Retrieving data for: ["+JSON.stringify(e)+"], callback function is provided:["+!!t+"]"),this.check_consent(p))if(Xe)St(k,"getFeedbackWidgetData, Cannot enable feedback widgets in offline mode.");else{var i=this.url,n={widget_id:e._id,shown:1,sdk_version:J,sdk_name:H,platform:this.platform,app_version:this.app_version};if("nps"===e.type)i+="/o/surveys/nps/widget";else if("survey"===e.type)i+="/o/surveys/survey/widget";else{if("rating"!==e.type)return void St(k,"getFeedbackWidgetData, Unknown type info: ["+e.type+"]");i+="/o/surveys/rating/widget"}Ct("getFeedbackWidgetData",i,n,(function(e,i,n){if(e)return St(k,"getFeedbackWidgetData, Error occurred while fetching feedbacks: "+e),void(t&&t(null,e));try{var a=JSON.parse(n);return void(t&&t(a,null))}catch(e){St(k,"getFeedbackWidgetData, Error while parsing feedback widgets list: "+e),t&&t(null,e)}}),!0)}else t&&t(null,new Error("Consent for feedback not provided."));else St(k,"getFeedbackWidgetData, Expected the provided widget object to have a type but got: ["+JSON.stringify(e)+"], aborting.")},this.present_feedback_widget=function(e,t,i){if(St(S,"present_feedback_widget, Presenting the feedback widget by appending to the element with ID: [ "+t+" ] and className: [ "+i+" ]"),this.check_consent(p))if(e&&"object"==typeof e&&!Array.isArray(e))try{var n=this.url;if("nps"===e.type)St(C,"present_feedback_widget, Widget type: nps."),n+="/feedback/nps";else if("survey"===e.type)St(C,"present_feedback_widget, Widget type: survey."),n+="/feedback/survey";else{if("rating"!==e.type)return void St(k,"present_feedback_widget, Feedback widget only accepts nps, rating and survey types.");St(C,"present_feedback_widget, Widget type: rating."),n+="/feedback/rating"}var a,r=window.origin||window.location.origin;"rating"===e.type?(St(C,"present_feedback_widget, Loading css for rating widget."),a="ratings",_e(this.url+"/star-rating/stylesheets/countly-feedback-web.css")):(St(C,"present_feedback_widget, Loading css for survey or nps."),_e(this.url+"/surveys/stylesheets/countly-surveys.css"),a="surveys"),n+="?widget_id="+e._id,n+="&app_key="+this.app_key,n+="&device_id="+this.device_id,n+="&sdk_name="+H,n+="&platform="+this.platform,n+="&app_version="+this.app_version,n+="&sdk_version="+J,n+="&origin="+r,n+="&widget_v=web";var o=document.createElement("iframe");o.src=n,o.name="countly-"+a+"-iframe",o.id="countly-"+a+"-iframe";var s=!1;o.onload=function(){s&&(document.getElementById("countly-"+a+"-wrapper-"+e._id).style.display="none",document.getElementById("csbg").style.display="none"),s=!0,St(C,"present_feedback_widget, Loaded iframe.")};for(var c=document.getElementById("csbg");c;)c.remove(),c=document.getElementById("csbg"),St(C,"present_feedback_widget, Removing past overlay.");for(var d=document.getElementsByClassName("countly-"+a+"-wrapper"),l=0;l<d.length;l++)d[l].remove(),St(C,"present_feedback_widget, Removed a wrapper.");(d=document.createElement("div")).className="countly-"+a+"-wrapper",d.id="countly-"+a+"-wrapper-"+e._id,"survey"===e.type&&(d.className=d.className+" "+e.appearance.position);var u=document.body,g=!1;if(t&&(document.getElementById(t)?(u=document.getElementById(t),g=!0):St(k,"present_feedback_widget, Provided ID not found.")),g||i&&(document.getElementsByClassName(i)[0]?u=document.getElementsByClassName(i)[0]:St(k,"present_feedback_widget, Provided class not found.")),u.insertAdjacentHTML("beforeend",'<div id="csbg"></div>'),u.appendChild(d),"rating"===e.type){var m=document.createElement("div");m.className="countly-ratings-overlay",m.id="countly-ratings-overlay-"+e._id,d.appendChild(m),St(C,"present_feedback_widget, appended the rating overlay to wrapper"),G(document.getElementById("countly-ratings-overlay-"+e._id),"click",(function(){document.getElementById("countly-ratings-wrapper-"+e._id).style.display="none"}))}if(d.appendChild(o),St(C,"present_feedback_widget, Appended the iframe"),G(window,"message",(function(t){var i={};try{i=JSON.parse(t.data),St(C,"present_feedback_widget, Parsed response message "+i)}catch(e){St(k,"present_feedback_widget, Error while parsing message body "+e)}i.close?(document.getElementById("countly-"+a+"-wrapper-"+e._id).style.display="none",document.getElementById("csbg").style.display="none"):St(C,"present_feedback_widget, Closing signal not sent yet")})),"survey"===e.type){var h=!1;switch(e.showPolicy){case"afterPageLoad":"complete"===document.readyState?h||(h=!0,_(e)):G(document,"readystatechange",(function(t){"complete"===t.target.readyState&&(h||(h=!0,_(e)))}));break;case"afterConstantDelay":setTimeout((function(){h||(h=!0,_(e))}),1e4);break;case"onAbandon":"complete"===document.readyState?G(document,"mouseleave",(function(){h||(h=!0,_(e))})):G(document,"readystatechange",(function(t){"complete"===t.target.readyState&&G(document,"mouseleave",(function(){h||(h=!0,_(e))}))}));break;case"onScrollHalfwayDown":G(window,"scroll",(function(){h||Math.max(window.scrollY,document.body.scrollTop,document.documentElement.scrollTop)>=ge()/2&&(h=!0,_(e))}));break;default:h||(h=!0,_(e))}}else if("nps"===e.type)document.getElementById("countly-"+a+"-wrapper-"+e._id).style.display="block",document.getElementById("csbg").style.display="block";else if("rating"===e.type){var f=!1;"complete"===document.readyState?f||(f=!0,y(e)):G(document,"readystatechange",(function(t){"complete"===t.target.readyState&&(f||(f=!0,y(e)))}))}}catch(e){St(k,"present_feedback_widget, Something went wrong while presenting the widget: "+e)}else St(k,"present_feedback_widget, Please provide at least one feedback widget object.");function _(e){document.getElementById("countly-surveys-wrapper-"+e._id).style.display="block",document.getElementById("csbg").style.display="block"}function y(e){if(!e.appearance.hideS){St(C,"present_feedback_widget, handling the sticker as it was not set to hidden");var t=document.createElement("div");t.innerText=e.appearance.text,t.style.color=e.appearance.text_color.length<7?"#"+e.appearance.text_color:e.appearance.text_color,t.style.backgroundColor=e.appearance.bg_color.length<7?"#"+e.appearance.bg_color:e.appearance.bg_color,t.className="countly-feedback-sticker  "+e.appearance.position+"-"+e.appearance.size,t.id="countly-feedback-sticker-"+e._id,document.body.appendChild(t),G(document.getElementById("countly-feedback-sticker-"+e._id),"click",(function(){document.getElementById("countly-ratings-wrapper-"+e._id).style.display="flex",document.getElementById("csbg").style.display="block"}))}G(document.getElementById("countly-feedback-close-icon-"+e._id),"click",(function(){document.getElementById("countly-ratings-wrapper-"+e._id).style.display="none",document.getElementById("csbg").style.display="none"}))}},this.recordError=function(e,t,i){if(St(S,"recordError, Recording error"),this.check_consent(s)&&e){i=i||Oe;var n="";if("object"==typeof e?void 0!==e.stack?n=e.stack:(void 0!==e.name&&(n+=e.name+":"),void 0!==e.message&&(n+=e.message+"\n"),void 0!==e.fileName&&(n+="in "+e.fileName+"\n"),void 0!==e.lineNumber&&(n+="on "+e.lineNumber),void 0!==e.columnNumber&&(n+=":"+e.columnNumber)):n=e+"",n.length>we.maxStackTraceLineLength*we.maxStackTraceLinesPerThread){St(C,"record_error, Error stack is too long will be truncated");var a=n.split("\n");a.length>we.maxStackTraceLinesPerThread&&(a=a.splice(0,we.maxStackTraceLinesPerThread));for(var r=0,o=a.length;r<o;r++)a[r].length>we.maxStackTraceLineLength&&(a[r]=a[r].substring(0,we.maxStackTraceLineLength));n=a.join("\n")}t=!!t;var c=xt(),d={_resolution:c._resolution,_error:n,_app_version:c._app_version,_run:Z()-Ze,_not_os_specific:!0,_javascript:!0},l=navigator.battery||navigator.webkitBattery||navigator.mozBattery||navigator.msBattery;l&&(d._bat=Math.floor(100*l.level)),void 0!==navigator.onLine&&(d._online=!!navigator.onLine),d._background=!document.hasFocus(),De.length>0&&(d._logs=De.join("\n")),De=[],d._nonfatal=t,d._view=this.getViewName(),void 0!==i&&(i=oe(i,we.maxKeyLength,we.maxValueSize,we.maxSegmentationValues,"record_error",St),d._custom=i);try{var u=document.createElement("canvas").getContext("experimental-webgl");d._opengl=u.getParameter(u.VERSION)}catch(e){St(k,"Could not get the experimental-webgl context: "+e)}var g={};g.crash=JSON.stringify(d),g.metrics=JSON.stringify({_ua:c._ua}),wt(g)}},this.onStorageChange=function(e,t){switch(St(S,"onStorageChange, Applying storage changes"),e){case"cly_queue":ze=we.deserialize(t||"[]");break;case"cly_event":Le=we.deserialize(t||"[]");break;case"cly_remote_configs":Ie=we.deserialize(t||"{}");break;case"cly_ignore":we.ignore_visitor=we.deserialize(t);break;case"cly_id":we.device_id=we.deserialize(t);break;case"cly_id_type":it=we.deserialize(t)}},this._internals={store:Ot,getDocWidth:pe,getDocHeight:ge,getViewportHeight:me,get_page_coord:ue,get_event_target:X,add_event:G,createNewObjectFromProperties:re,truncateObject:oe,truncateSingleValue:se,stripTrailingSlash:ae,prepareParams:ne,sendXmlHttpRequest:Ct,isResponseValid:Et,getInternalDeviceIdType:function(){return it},getMsTimestamp:ee,getTimestamp:Z,isResponseValidBroad:zt,log:St,getMetrics:xt,generateUUID:Q,sendEventsForced:mt,isUUID:function(e){return/[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-4[0-9a-fA-F]{3}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}/.test(e)},getId:kt,heartBeat:bt,toRequestQueue:wt,reportViewDuration:_t,loadJS:fe,loadCSS:_e,getLastView:function(){return Re},setToken:Dt,getToken:function(){var e=Nt("cly_token");return At("cly_token"),e},showLoader:ye,hideLoader:ve,setValueInStorage:Ot,getValueFromStorage:Nt,removeValueFromStorage:At,add_cly_events:dt,processScrollView:It,processScroll:Lt,currentUserAgentString:ce,userAgentDeviceDetection:de,userAgentSearchBotDetection:le,getRequestQueue:function(){return ze},getEventQueue:function(){return Le},clearQueue:function(){ze=[],Ot("cly_queue",[]),Le=[],Ot("cly_event",[])}},this.initialize()},e.init=function(t){var i=(t=t||{}).app_key||e.app_key;if(!e.i||!e.i[i]){var n=new e.CountlyClass(t);if(!e.i)for(var a in e.i={},n)e[a]=n[a];e.i[i]=n}return e.i[i]};var Y=0,K=function(e,t){for(t=t.toUpperCase();e;){if(e.nodeName.toUpperCase()===t)return e;e=e.parentElement}},G=function(e,t,i){void 0!==e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent("on"+t,i)},X=function(e){return e?void 0!==e.target?e.target:e.srcElement:window.event.srcElement};return window.addEventListener("storage",(function(t){var i=(t.key+"").split("/"),n=i.pop(),a=i.pop();e.i&&e.i[a]&&e.i[a].onStorageChange(n,t.newValue)})),e.serialize=function(e){return"object"==typeof e&&(e=JSON.stringify(e)),e},e.deserialize=function(e){try{e=JSON.parse(e)}catch(e){}return e},e.getViewName=function(){return window.location.pathname},e.getViewUrl=function(){return window.location.pathname},e.getSearchQuery=function(){return window.location.search},e.DeviceIdType={DEVELOPER_SUPPLIED:z,SDK_GENERATED:L,TEMPORARY_ID:I},e}function $(e){var t=[];if(void 0!==e.options)for(var i=0;i<e.options.length;i++)e.options[i].selected&&t.push(e.options[i].value);return t.join(", ")}function Q(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?i:3&i|8).toString(16)}))}function Z(){return Math.floor((new Date).getTime()/1e3)}function ee(){var e=(new Date).getTime();return Y>=e?Y++:Y=e,Y}function te(t,i,n){if(i&&Object.keys(i).length){if(void 0!==i[t])return i[t]}else if(void 0!==e[t])return e[t];return n}function ie(t,i,n){for(var a in e.i)e.i[a].tracking_crashes&&e.i[a].recordError(t,i,n)}function ne(e){var t=[];for(var i in e)t.push(i+"="+encodeURIComponent(e[i]));return t.join("&")}function ae(e){return"string"==typeof e&&"/"===e.substring(e.length-1)?e.substring(0,e.length-1):e}function re(e,t){for(var i,n={},a=0,r=t.length;a<r;a++)void 0!==e[i=t[a]]&&(n[i]=e[i]);return n}function oe(e,t,i,n,a,r){var o={};if(e){if(Object.keys(e).length>n){var s={},c=0;for(var d in e)c<n&&(s[d]=e[d],c++);e=s}for(var l in e){var u=se(l,t,a,r),g=se(e[l],i,a,r);o[u]=g}}return o}function se(e,t,i,n){var a=e;return"number"==typeof e&&(e=e.toString()),"string"==typeof e&&e.length>t&&(a=e.substring(0,t),n(C,i+", Key: [ "+e+" ] is longer than accepted length. It will be truncated.")),a}function ce(e){if(e)return e;var t=navigator.userAgent;return t||navigator.userAgentData&&(t=navigator.userAgentData.brands.map((function(e){return e.brand+":"+e.version})).join(),t+=navigator.userAgentData.mobile?" mobi ":" ",t+=navigator.userAgentData.platform),t}function de(e){var t;if(e)t=e;else{if(navigator.userAgentData.mobile)return"phone";t=ce()}t=t.toLowerCase();var i="desktop";return/(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/.test(t)?i="tablet":/(mobi|ipod|phone|blackberry|opera mini|fennec|minimo|symbian|psp|nintendo ds|archos|skyfire|puffin|blazer|bolt|gobrowser|iris|maemo|semc|teashark|uzard)/.test(t)&&(i="phone"),i}function le(e){return/(CountlySiteBot|nuhk|Googlebot|GoogleSecurityScanner|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver|bingbot|Google Web Preview|Mediapartners-Google|AdsBot-Google|Baiduspider|Ezooms|YahooSeeker|AltaVista|AVSearch|Mercator|Scooter|InfoSeek|Ultraseek|Lycos|Wget|YandexBot|Yandex|YaDirectFetcher|SiteBot|Exabot|AhrefsBot|MJ12bot|TurnitinBot|magpie-crawler|Nutch Crawler|CMS Crawler|rogerbot|Domnutch|ssearch_bot|XoviBot|netseer|digincore|fr-crawler|wesee|AliasIO|contxbot|PingdomBot|BingPreview|HeadlessChrome)/.test(e||ce())}function ue(e){return void 0===e.pageY&&"number"==typeof e.clientX&&document.documentElement&&(e.pageX=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,e.pageY=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),e}function ge(){var e=document;return Math.max(Math.max(e.body.scrollHeight,e.documentElement.scrollHeight),Math.max(e.body.offsetHeight,e.documentElement.offsetHeight),Math.max(e.body.clientHeight,e.documentElement.clientHeight))}function pe(){var e=document;return Math.max(Math.max(e.body.scrollWidth,e.documentElement.scrollWidth),Math.max(e.body.offsetWidth,e.documentElement.offsetWidth),Math.max(e.body.clientWidth,e.documentElement.clientWidth))}function me(){var e=document;return Math.min(Math.min(e.body.clientHeight,e.documentElement.clientHeight),Math.min(e.body.offsetHeight,e.documentElement.offsetHeight),window.innerHeight)}function he(e,t,i,n,a,r){var o,s=document.createElement(e);s.setAttribute(t,i),s.setAttribute(n,a);var c=function(){o||r(),o=!0};r&&(s.onreadystatechange=c,s.onload=c),document.getElementsByTagName("head")[0].appendChild(s)}function fe(e,t){he("script","type","text/javascript","src",e,t)}function _e(e,t){he("link","rel","stylesheet","href",e,t)}function ye(){var t=document.getElementById("cly-loader");if(!t){var i="#cly-loader {height: 4px; width: 100%; position: absolute; z-index: 99999; overflow: hidden; background-color: #fff; top:0px; left:0px;}#cly-loader:before{display: block; position: absolute; content: ''; left: -200px; width: 200px; height: 4px; background-color: #2EB52B; animation: cly-loading 2s linear infinite;}@keyframes cly-loading { from {left: -200px; width: 30%;} 50% {width: 30%;} 70% {width: 70%;} 80% { left: 50%;} 95% {left: 120%;} to {left: 100%;}}",n=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=i:a.appendChild(document.createTextNode(i)),n.appendChild(a),(t=document.createElement("div")).setAttribute("id","cly-loader"),document.body.onload=function(){if(!e.showLoaderProtection)try{document.body.appendChild(t)}catch(e){}}}t.style.display="block"}function ve(){e.showLoaderProtection=!0;var t=document.getElementById("cly-loader");t&&(t.style.display="none")}},r.exports?r.exports=s(o.Countly):o.Countly=s(o.Countly);var l=d.exports;const u=(e,t)=>{window.Countly=l,l.init({app_key:e,url:t,require_consent:!0});const i=["sessions","views"],n=["attribution","users","location"],a=["events","crashes","apm"],r=["scrolls","clicks","forms","star-rating","feedback"];l.group_features({all:[...i,...n,...a,...r],necessary:i,marketing:n,tracking:r,performance:a}),l.track_clicks(),l.track_errors(),l.track_forms(),l.track_links(),l.track_pageview(),l.track_scrolls(),l.track_sessions(),l.track_view()},g=e=>{l.add_consent(e),Array.isArray(e)?localStorage.setItem("metrics_consent",JSON.stringify(e)):localStorage.setItem("metrics_consent",JSON.stringify([e]))},p=()=>{g(["all"])},m=()=>{g(["necessary"])},h=()=>localStorage.getItem("metrics_consent");export{i as ConsentBanner,n as ConsentToggle,u as InitCountlyMetrics,a as Warning,p as acceptMetricsConsent,m as declineMetricsConsent,h as getMetricsConsent,g as updateMetricsConsent};
